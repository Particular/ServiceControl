import{e as ce,r as f,f as fe,i as ve,u as _e,ad as me,o as pe,p as w,n,x as u,v as c,aq as we,q as o,y as v,B as k,m as r,K as V,L as P,ai as R,t as i,N as ke,E,z as p,ab as T,ac as F,a6 as M,ag as U,ah as ge,T as he,C as ye,ax as be,ay as K,P as Q,Q as W,k as Ce,U as xe}from"./index-C-3C3fiy.js";import{c as Re}from"./messageGroupClient-8SmTpJE8.js";import{M as g}from"./MetadataItem-CccIzZNT.js";const Me={name:"message_groups"},Ge={class:"row"},Ie={class:"col-6 toolbar-menus no-side-padding"},$e={class:"msg-group-menu dropdown"},De={type:"button",class:"btn btn-default dropdown-toggle sp-btn-menu","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},Se={class:"dropdown-menu"},Ee=["onClick"],Te={class:"box-container"},Fe={class:"messagegrouplist"},qe={class:"row"},Le={class:"col-sm-12"},Oe={class:"row"},Ne={class:"col-sm-12 no-mobile-side-padding"},Be={key:0},ze=["disabled","onMouseenter","onMouseleave","onClick"],Ae={class:"col-sm-12 no-mobile-side-padding"},Ve={class:"row"},Pe={class:"col-sm-12 no-side-padding"},Ue={class:"row box-header"},Ke={class:"col-sm-12 no-side-padding"},Qe={key:0,class:"metadata"},We={key:0},Ye={key:1},je={key:0,class:"row"},He={class:"col-sm-12 no-side-padding"},Je={key:1,class:"row"},Xe={class:"col-sm-12 no-side-padding"},Ze={class:"panel panel-default panel-retry"},et={class:"panel-body"},tt={class:"retry-request-progress"},st={key:1},ot=["onClick"],at={class:"op-metadata"},nt=ce({__name:"DeletedMessageGroups",emits:["InitialLoadComplete"],setup(it,{emit:Y}){const q=["restorestarted","restoreprogressing","restorefinalizing","restorecompleted"];let y=!1;const l=f([]),_=f([]),G=f(!0),L=f(!1),j=Y;let h;const H=fe(),J=ve(),b=f(!1),O=f(),N=_e(),B=Re(),I=f(null),$=f(null),D=f([]);async function X(){const[,e]=await N.fetchTypedFromServiceControl("recoverability/classifiers");D.value=e}function Z(e){K().cookies.set("archived_groups_classification",e)}async function ee(e){Z(e),$.value=e,l.value=[],await S(e)}async function te(e){const[,s]=await N.fetchTypedFromServiceControl(`errors/groups/${e}`);s.length===0&&_.value.length>0&&_.value.forEach(a=>{a.need_user_acknowledgement=!0,a.workflow_state.status="restorecompleted"}),_.value.forEach(a=>{s.find(d=>d.id===a.id)||(a.need_user_acknowledgement=!0,a.workflow_state.status="restorecompleted")});const t=s.filter(a=>!_.value.find(d=>d.id===a.id)).map(se).concat(_.value);let m=l.value.reduce((a,d)=>Math.max(a,d.index),0);t.forEach(a=>{const d=l.value.find(ue=>ue.id===a.id);d?a.index=d.index:a.index=++m}),l.value=t.sort((a,d)=>a.index-d.index)}function se(e){return{index:0,workflow_state:oe("none"),...e}}function z(){const s=K().cookies.get("archived_groups_classification");return s||null}async function S(e=null){G.value=!0,(!L.value||!e)&&(e=z()),await te(e??H.query.deletedGroupBy),G.value=!1,L.value=!0,j("InitialLoadComplete")}function oe(e,s,t){return{status:e??"working",total:s??0,failed:t??!1}}function ae(e){I.value=null,O.value=e,b.value=!0}async function ne(){const e=O.value;if(e){x(1e3),_.value.push(e),e.workflow_state={status:"restorestarted",message:"Restore request initiated..."},e.operation_start_time=new Date().toUTCString();const s=await B.restoreGroup(e.id);B.isError(s)?(I.value=!1,Q(W.ERROR,"Error",`Failed to restore the group: ${s.message}`)):(I.value=!0,Q(W.INFO,"Info","Group restore started..."))}}const ie=function(e,s,t){const m=t.indexOf(e),a=t.indexOf(s);return m>a?"left-to-do":m===a?"active":"completed"};function re(e,s){return ie(e,s,q)}const le=function(e){_.value.splice(_.value.findIndex(s=>s.id===e.id),1),l.value.splice(l.value.findIndex(s=>s.id===e.id),1)};function C(e){return q.includes(e)}function de(e){J.push(Ce.failedMessage.deletedGroup.link(e))}function A(){return l.value.some(e=>e.workflow_state.status!=="none"&&e.workflow_state.status!=="restorecompleted")}function x(e){h&&clearInterval(h),h=window.setInterval(()=>{!y&&A()?(x(1e3),y=!0):y&&!A()&&(x(5e3),y=!1),S()},e)}return me(()=>{h&&clearInterval(h)}),pe(async()=>{await X();let e=z();e||(e=D.value[0]),$.value=e,await S(),x(5e3)}),(e,s)=>(n(),w(be,null,{default:u(()=>[c(we,null,{default:u(()=>[o("section",Me,[o("div",Ge,[s[4]||(s[4]=o("div",{class:"col-6 list-section"},[o("h3",null,"Deleted message group")],-1)),o("div",Ie,[o("div",$e,[s[3]||(s[3]=o("label",{class:"control-label"},"Group by:",-1)),o("button",De,[v(k($.value)+" ",1),s[2]||(s[2]=o("span",{class:"caret"},null,-1))]),o("ul",Se,[(n(!0),r(V,null,P(D.value,(t,m)=>(n(),r("li",{key:m},[o("a",{onClick:R(a=>ee(t),["prevent"])},k(t),9,Ee)]))),128))])])])]),o("div",Te,[o("div",Fe,[o("div",null,[o("div",qe,[o("div",Le,[l.value.length===0&&!G.value?(n(),w(ke,{key:0,title:"message groups",message:"There are currently no grouped message failures"})):i("",!0)])]),o("div",Oe,[o("div",Ne,[l.value.length>0?(n(),r("div",Be,[(n(!0),r(V,null,P(l.value,(t,m)=>(n(),r("div",{class:E(`row box box-group wf-${t.workflow_state.status} repeat-modify deleted-message-group`),key:m,disabled:t.count==0,onMouseenter:a=>t.hover2=!0,onMouseleave:a=>t.hover2=!1,onClick:R(a=>de(t.id),["prevent"])},[o("div",Ae,[o("div",Ve,[o("div",Pe,[o("div",Ue,[o("div",Ke,[o("p",{class:E(["lead break",{"msg-type-hover":t.hover2,"msg-type-hover-off":t.hover3}])},k(t.title),3),C(t.workflow_state.status)?i("",!0):(n(),r("p",Qe,[c(g,{icon:p(T)},{default:u(()=>[v(k(t.count)+" message",1),t.count>1?(n(),r("span",We,"s")):i("",!0),t.operation_remaining_count?(n(),r("span",Ye," (currently restoring "+k(t.operation_remaining_count),1)):i("",!0)]),_:2},1032,["icon"]),c(g,{icon:p(F)},{default:u(()=>[s[5]||(s[5]=v(" First failed: ",-1)),c(M,{"date-utc":t.first},null,8,["date-utc"])]),_:2},1032,["icon"]),c(g,{icon:p(F)},{default:u(()=>[s[6]||(s[6]=v(" Last failed: ",-1)),c(M,{"date-utc":t.last},null,8,["date-utc"])]),_:2},1032,["icon"]),c(g,{icon:p(U)},{default:u(()=>[s[7]||(s[7]=v(" Last retried: ",-1)),c(M,{"date-utc":t.last_operation_completion_time},null,8,["date-utc"])]),_:2},1032,["icon"])]))])]),C(t.workflow_state.status)?i("",!0):(n(),r("div",je,[o("div",He,[l.value.length>0?(n(),w(ge,{key:0,variant:"link",size:"sm",icon:p(U),disabled:t.count===0||C(t.workflow_state.status),onMouseenter:a=>t.hover3=!0,onMouseleave:a=>t.hover3=!1,onClick:R(a=>ae(t),["stop"])},{default:u(()=>[...s[8]||(s[8]=[v(" Restore group ",-1)])]),_:1},8,["icon","disabled","onMouseenter","onMouseleave","onClick"])):i("",!0)])])),C(t.workflow_state.status)?(n(),r("div",Je,[o("div",Xe,[o("div",Ze,[o("div",et,[o("ul",tt,[t.workflow_state.status!=="restorecompleted"?(n(),r("li",{key:0,class:E(re("restorestarted",t.workflow_state.status))},[...s[9]||(s[9]=[o("div",{class:"bulk-retry-progress-status"},"Restore request in progress...",-1)])],2)):i("",!0),t.workflow_state.status==="restorecompleted"?(n(),r("li",st,[s[10]||(s[10]=o("div",{class:"retry-completed bulk-retry-progress-status"},"Restore request completed",-1)),t.need_user_acknowledgement==!0?(n(),r("button",{key:0,type:"button",class:"btn btn-default btn-primary btn-xs btn-retry-dismiss",onClick:R(a=>le(t),["stop"])},"Dismiss",8,ot)):i("",!0)])):i("",!0)]),o("div",at,[c(g,{icon:p(F)},{default:u(()=>[s[11]||(s[11]=v(" Restore request started: ",-1)),c(M,{"date-utc":t.operation_start_time},null,8,["date-utc"])]),_:2},1032,["icon"]),t.workflow_state.status==="restorecompleted"?(n(),w(g,{key:0,icon:p(T)},{default:u(()=>[v(" Messages restored: "+k(t.count),1)]),_:2},1032,["icon"])):i("",!0),t.workflow_state.status!=="restorecompleted"?(n(),w(g,{key:1,icon:p(T)},{default:u(()=>[v(" Messages being restored: "+k(t.count),1)]),_:2},1032,["icon"])):i("",!0)])])])])])):i("",!0)])])])],42,ze))),128))])):i("",!0)])])])]),(n(),w(he,{to:"#modalDisplay"},[b.value?(n(),w(ye,{key:0,onCancel:s[0]||(s[0]=t=>b.value=!1),onConfirm:s[1]||(s[1]=t=>{b.value=!1,ne()}),heading:"Are you sure you want to restore this group?",body:"Restored messages will be moved back to the list of failed messages"})):i("",!0)]))])])]),_:1})]),_:1}))}}),ut=xe(nt,[["__scopeId","data-v-7bf81429"]]);export{ut as default};
//# sourceMappingURL=DeletedMessageGroups-DUQVzrxT.js.map
