{"version":3,"file":"PlatformConnections-BUpIALIS.js","sources":["../../../../frontend/src/components/configuration/PlatformConnections.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ref } from \"vue\";\nimport { faCheck, faExclamationTriangle } from \"@fortawesome/free-solid-svg-icons\";\nimport FAIcon from \"@/components/FAIcon.vue\";\nimport useConnectionsAndStatsAutoRefresh from \"@/composables/useConnectionsAndStatsAutoRefresh\";\nimport { useServiceControlStore } from \"@/stores/ServiceControlStore\";\nimport { storeToRefs } from \"pinia\";\n\nconst { store: connectionStore } = useConnectionsAndStatsAutoRefresh();\nconst connectionState = connectionStore.connectionState;\nconst monitoringConnectionState = connectionStore.monitoringConnectionState;\n\nconst serviceControlStore = useServiceControlStore();\nserviceControlStore.refresh();\nconst localServiceControlUrl = ref(serviceControlStore.serviceControlUrl);\nconst localMonitoringUrl = ref(serviceControlStore.monitoringUrl);\nconst { isMonitoringDisabled } = storeToRefs(serviceControlStore);\n\nconst testingServiceControl = ref(false);\nconst serviceControlValid = ref<boolean | null>(null);\n\nconst testingMonitoring = ref(false);\nconst monitoringValid = ref<boolean | null>(null);\n\nconst connectionSaved = ref<boolean | null>(null);\n\nasync function testServiceControlUrl() {\n  if (localServiceControlUrl.value) {\n    testingServiceControl.value = true;\n    try {\n      const response = await fetch(localServiceControlUrl.value);\n      serviceControlValid.value = response.ok && response.headers.has(\"X-Particular-Version\");\n    } catch {\n      serviceControlValid.value = false;\n    } finally {\n      testingServiceControl.value = false;\n    }\n  }\n}\n\nasync function testMonitoringUrl() {\n  if (localMonitoringUrl.value) {\n    testingMonitoring.value = true;\n\n    if (!localMonitoringUrl.value.endsWith(\"/\") && localMonitoringUrl.value !== \"!\") {\n      localMonitoringUrl.value += \"/\";\n    }\n\n    try {\n      const response = await fetch(localMonitoringUrl.value + \"monitored-endpoints\");\n      monitoringValid.value = response.ok && response.headers.has(\"X-Particular-Version\");\n    } catch {\n      monitoringValid.value = false;\n    } finally {\n      testingMonitoring.value = false;\n    }\n  }\n}\n\nfunction isMonitoringUrlSpecified() {\n  return localMonitoringUrl.value && localMonitoringUrl.value !== \"!\";\n}\n\nfunction saveConnections() {\n  updateServiceControlUrls();\n  connectionSaved.value = true;\n}\n\nfunction updateServiceControlUrls() {\n  if (!localServiceControlUrl.value) {\n    throw new Error(\"ServiceControl URL is mandatory\");\n  } else if (!localServiceControlUrl.value.endsWith(\"/\")) {\n    localServiceControlUrl.value += \"/\";\n  }\n\n  if (!localMonitoringUrl.value) {\n    localMonitoringUrl.value = \"!\"; //disabled\n  } else if (!localMonitoringUrl.value.endsWith(\"/\") && localMonitoringUrl.value !== \"!\") {\n    localMonitoringUrl.value += \"/\";\n  }\n\n  //values have changed. They'll be reset after page reloads\n  window.localStorage.removeItem(\"scu\");\n  window.localStorage.removeItem(\"mu\");\n\n  const newSearch = `?scu=${localServiceControlUrl.value}&mu=${localMonitoringUrl.value}`;\n  console.debug(\"updateConnections - new query string: \", newSearch);\n  window.location.search = newSearch;\n}\n</script>\n\n<template>\n  <section name=\"connections\">\n    <div class=\"box\">\n      <div class=\"row\">\n        <div class=\"col-12\">\n          <form novalidate>\n            <div class=\"row connection\">\n              <h3>ServiceControl</h3>\n              <div class=\"col-7 form-group\">\n                <label for=\"serviceControlUrl\">\n                  CONNECTION URL\n                  <template v-if=\"connectionState.unableToConnect\">\n                    <span class=\"failed-validation\"><FAIcon :icon=\"faExclamationTriangle\" /> Unable to connect </span>\n                  </template>\n                </label>\n                <input type=\"text\" id=\"serviceControlUrl\" name=\"serviceControlUrl\" v-model=\"localServiceControlUrl\" class=\"form-control\" style=\"color: #000\" required />\n              </div>\n\n              <div class=\"col-5 no-side-padding\">\n                <button class=\"btn btn-default btn-secondary btn-connection-test\" :class=\"{ disabled: !localServiceControlUrl }\" type=\"button\" @click=\"testServiceControlUrl\">Test</button>\n                <span class=\"connection-test connection-testing\" v-if=\"testingServiceControl\"> <i class=\"glyphicon glyphicon-refresh rotate\"></i>Testing </span>\n                <span class=\"connection-test connection-successful\" v-if=\"serviceControlValid === true && !testingServiceControl\"><FAIcon :icon=\"faCheck\" /> Connection successful </span>\n                <span class=\"connection-test connection-failed\" v-if=\"serviceControlValid === false && !testingServiceControl\"><FAIcon :icon=\"faExclamationTriangle\" /> Connection failed </span>\n              </div>\n            </div>\n\n            <div class=\"row connection\">\n              <h3>ServiceControl Monitoring</h3>\n              <div class=\"col-7 form-group\">\n                <label for=\"monitoringUrl\">\n                  CONNECTION URL\n                  <span class=\"auxilliary-label\">(OPTIONAL) (Enter ! to disable monitoring)</span>\n                  <template v-if=\"monitoringConnectionState.unableToConnect && !isMonitoringDisabled\">\n                    <span class=\"failed-validation\"><FAIcon :icon=\"faExclamationTriangle\" /> Unable to connect </span>\n                  </template>\n                </label>\n                <input type=\"text\" id=\"monitoringUrl\" name=\"monitoringUrl\" v-model=\"localMonitoringUrl\" class=\"form-control\" required />\n              </div>\n\n              <div class=\"col-5 no-side-padding\">\n                <button class=\"btn btn-default btn-secondary btn-connection-test\" :class=\"{ disabled: !isMonitoringUrlSpecified() }\" type=\"button\" @click=\"testMonitoringUrl\" :disabled=\"!isMonitoringUrlSpecified()\">Test</button>\n                <span class=\"connection-test connection-testing\" v-if=\"testingMonitoring\"> <i class=\"glyphicon glyphicon-refresh rotate\"></i>Testing </span>\n                <span class=\"connection-test connection-successful\" v-if=\"monitoringValid === true && !testingMonitoring\"><FAIcon :icon=\"faCheck\" /> Connection successful </span>\n                <span class=\"connection-test connection-failed\" v-if=\"monitoringValid === false && !testingMonitoring\"><FAIcon :icon=\"faExclamationTriangle\" /> Connection failed </span>\n              </div>\n            </div>\n\n            <button class=\"btn btn-primary\" type=\"button\" @click=\"saveConnections\">Save</button>\n            <span class=\"connection-test connection-successful hide save-connection\" v-show=\"connectionSaved\"><FAIcon :icon=\"faCheck\" /> Connection saved </span>\n            <span class=\"connection-test connection-failed hide save-connection\" v-show=\"connectionSaved != null && !connectionSaved\"><FAIcon :icon=\"faExclamationTriangle\" /> Unable to save </span>\n          </form>\n        </div>\n      </div>\n    </div>\n  </section>\n</template>\n\n<style scoped>\nsection[name=\"connections\"] .box {\n  padding-bottom: 50px;\n}\n\nform .connection h3 {\n  margin-bottom: 16px;\n  margin-top: 25px;\n  padding-left: 0;\n}\n\nform .connection .form-group {\n  padding-left: 0;\n}\n\n.connection:nth-child(2) h3 {\n  margin-top: 40px;\n}\n\nform .connection .form-group input {\n  font-size: 16px;\n  height: 44px;\n}\n\n.row.connection {\n  margin-left: 0;\n}\n\nspan.connection-test.save-connection {\n  top: 0;\n}\n\n.btn-connection-test {\n  margin-top: 25px;\n  padding-top: 11px;\n  padding-bottom: 11px;\n}\n</style>\n"],"names":["connectionStore","useConnectionsAndStatsAutoRefresh","connectionState","monitoringConnectionState","serviceControlStore","useServiceControlStore","localServiceControlUrl","ref","localMonitoringUrl","isMonitoringDisabled","storeToRefs","testingServiceControl","serviceControlValid","testingMonitoring","monitoringValid","connectionSaved","testServiceControlUrl","response","testMonitoringUrl","isMonitoringUrlSpecified","saveConnections","updateServiceControlUrls","newSearch","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_cache","_hoisted_7","_hoisted_8","_unref","_hoisted_9","_createVNode","FAIcon","faExclamationTriangle","$event","_hoisted_10","_normalizeClass","_hoisted_11","_hoisted_12","faCheck","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_withDirectives","_hoisted_23","_hoisted_24","_vShow"],"mappings":"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"}