import{e as te,f as se,r as n,ay as oe,w as ae,aD as ne,s as le,u as re,az as ie,ad as de,o as ue,p as M,n as a,x as B,v as D,aq as ce,q as s,m as d,t as u,B as v,y as L,_ as ge,z as fe,ag as ve,K as _e,L as pe,ai as me,a5 as he,T as be,C as we,ax as ye,P as De,Q as Se,h as H,U as ke}from"./index-Cy3_77ur.js";import{M as Ce}from"./MessageList-Bv6PeXYU.js";const Ie={name:"message_groups"},Pe={key:0,class:"row"},$e={class:"col-sm-12"},Ae={key:0,class:"active break group-title"},Me={class:"active group-title group-message-count"},He={class:"row"},Re={class:"col-9"},Te={class:"btn-toolbar"},xe=["disabled"],Ne={class:"col-3"},Ve={class:"msg-group-menu dropdown"},Be={type:"button",class:"btn btn-default dropdown-toggle sp-btn-menu","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},Le={class:"dropdown-menu"},Oe=["onClick"],Ee={class:"row"},Fe={class:"col-12"},Ue={key:1,class:"row"},O=50,qe=te({__name:"DeletedMessages",setup(ze){let _=!1,c;const E=se(),R=n(E.params.groupId),i=n(""),p=n(1),S=n(0),T=oe().cookies,k=["All Deleted","Deleted in the last 2 Hours","Deleted in the last 1 Day","Deleted in the last 7 days"],m=n("Deleted in the last 7 days"),h=n(!1),l=n(),r=n([]);ae(p,()=>b());const F=ne(),{configuration:U}=le(F),C=re();function b(){let e=new Date(0);const t=new Date;switch(m.value){case"All Deleted":e=new Date,e.setHours(e.getHours()-24*365);break;case"Deleted in the last 2 Hours":e=new Date,e.setHours(e.getHours()-2);break;case"Deleted in the last 1 Day":e=new Date,e.setHours(e.getHours()-24);break;case"Deleted in the last 7 days":e=new Date,e.setHours(e.getHours()-168);break}return z(R.value,p.value,"","",e.toISOString(),t.toISOString())}async function q(e){const[,t]=await C.fetchTypedFromServiceControl(`archive/groups/id/${e}`);i.value=t.title}function z(e,t=1,o="modified",P="desc",N=new Date(0).toISOString(),W=new Date().toISOString()){const X=N+"..."+W;let $;e&&!i.value&&($=q(e));async function Z(){try{const[A,y]=await C.fetchTypedFromServiceControl(`${e?`recoverability/groups/${e}/`:""}errors?status=archived&page=${t}&per_page=${O}&sort=${o}&direction=${P}&modified=${X}`);S.value=parseInt(A.headers.get("Total-Count")??"0"),r.value.length&&y.length&&r.value.forEach(g=>{const f=y.find(ee=>ee.id===g.id);f&&(g.last_modified===f.last_modified&&(f.retryInProgress=g.retryInProgress,f.deleteInProgress=g.deleteInProgress),f.selected=g.selected)}),r.value=G(y)}catch(A){return console.log(A),{message:"error"}}}const V=Z();return $?Promise.all([$,V]):V}function G(e){return e.forEach(t=>{t.error_retention_period=H.duration(U.value?.data_retention.error_retention_period).asHours();const o=H(t.last_modified).add(t.error_retention_period,"hours");t.delete_soon=o<H(),t.deleted_in=o.format()}),e}function K(){return l.value?.getSelectedMessages()?.length??0}function Q(){l.value?.selectAll()}function Y(){l.value?.deselectAll()}function I(){return l.value?.isAnythingSelected()}async function j(){w(1e3);const e=l.value?.getSelectedMessages()??[];e.forEach(t=>t.restoreInProgress=!0),De(Se.INFO,"Info",`restoring ${e.length} messages...`),await C.patchToServiceControl("errors/unarchive",e.map(t=>t.id)),l.value?.deselectAll()}function J(e){m.value=e,T.set("all_deleted_messages_period",e),b()}function x(){return r.value.some(e=>e.restoreInProgress)}function w(e){c!=null&&window.clearInterval(c),c=window.setInterval(()=>{!_&&x()?(w(1e3),_=!0):_&&!x()&&(w(5e3),_=!1),b()},e)}return ie(()=>{R.value="",i.value=""}),de(()=>{c!=null&&window.clearInterval(c)}),ue(()=>{let e=T.get("all_deleted_messages_period");e||(e=k[k.length-1]),m.value=e,b(),w(5e3)}),(e,t)=>(a(),M(ye,null,{default:B(()=>[D(ce,null,{default:B(()=>[s("section",Ie,[i.value&&r.value.length>0?(a(),d("div",Pe,[s("div",$e,[i.value?(a(),d("h1",Ae,v(i.value),1)):u("",!0),s("h3",Me,v(S.value)+" messages in group",1)])])):u("",!0),s("div",He,[s("div",Re,[s("div",Te,[I()?u("",!0):(a(),d("button",{key:0,type:"button",class:"btn btn-default select-all",onClick:Q},"Select all")),I()?(a(),d("button",{key:1,type:"button",class:"btn btn-default select-all",onClick:Y},"Clear selection")):u("",!0),s("button",{type:"button",class:"btn btn-default",onClick:t[0]||(t[0]=o=>h.value=!0),disabled:!I()},[D(ge,{icon:fe(ve),class:"icon"},null,8,["icon"]),L(" Restore "+v(K())+" selected",1)],8,xe)])]),s("div",Ne,[s("div",Ve,[t[5]||(t[5]=s("label",{class:"control-label"},"Show:",-1)),s("button",Be,[L(v(m.value)+" ",1),t[4]||(t[4]=s("span",{class:"caret"},null,-1))]),s("ul",Le,[(a(),d(_e,null,pe(k,(o,P)=>s("li",{key:P},[s("a",{onClick:me(N=>J(o),["prevent"])},v(o),9,Oe)])),64))])])])]),s("div",Ee,[s("div",Fe,[D(Ce,{messages:r.value,ref_key:"messageList",ref:l},null,8,["messages"])])]),r.value.length>0?(a(),d("div",Ue,[D(he,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=o=>p.value=o),"total-count":S.value,"items-per-page":O},null,8,["modelValue","total-count"])])):u("",!0),(a(),M(be,{to:"#modalDisplay"},[h.value?(a(),M(we,{key:0,onCancel:t[2]||(t[2]=o=>h.value=!1),onConfirm:t[3]||(t[3]=o=>{h.value=!1,j()}),heading:"Are you sure you want to restore the selected messages?",body:"Restored messages will be moved back to the list of failed messages."})):u("",!0)]))])]),_:1})]),_:1}))}}),Qe=ke(qe,[["__scopeId","data-v-24571ba4"]]);export{Qe as default};
//# sourceMappingURL=DeletedMessages-DV0Kglsw.js.map
