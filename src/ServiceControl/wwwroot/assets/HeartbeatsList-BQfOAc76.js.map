{"version":3,"file":"HeartbeatsList-BQfOAc76.js","sources":["../../../../frontend/src/components/heartbeats/HeartbeatsList.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ColumnNames } from \"@/stores/HeartbeatsStore\";\nimport { storeToRefs } from \"pinia\";\nimport DataView from \"@/components/DataView.vue\";\nimport OnOffSwitch from \"../OnOffSwitch.vue\";\nimport routeLinks from \"@/router/routeLinks\";\nimport { useRoute } from \"vue-router\";\nimport { Tippy } from \"vue-tippy\";\nimport { LogicalEndpoint } from \"@/resources/Heartbeat\";\nimport { useShowToast } from \"@/composables/toast\";\nimport { TYPE } from \"vue-toastification\";\nimport LastHeartbeat from \"@/components/heartbeats/LastHeartbeat.vue\";\nimport ColumnHeader from \"../ColumnHeader.vue\";\nimport FAIcon from \"@/components/FAIcon.vue\";\nimport { faBellSlash, faCheck, faCloud, faServer } from \"@fortawesome/free-solid-svg-icons\";\nimport useHeartbeatsStoreAutoRefresh from \"@/composables/useHeartbeatsStoreAutoRefresh\";\n\ndefineProps<{\n  data: LogicalEndpoint[];\n  columns: ColumnNames[];\n}>();\n\nconst { store } = useHeartbeatsStoreAutoRefresh();\nconst { sortByInstances, itemsPerPage } = storeToRefs(store);\nconst route = useRoute();\n\nasync function changeEndpointSettings(endpoint: LogicalEndpoint) {\n  try {\n    await store.updateEndpointSettings([endpoint]);\n    useShowToast(TYPE.SUCCESS, \"Saved\", \"\", false, { timeout: 3000 });\n  } catch {\n    useShowToast(TYPE.ERROR, \"Save failed\", \"\", false, { timeout: 3000 });\n  }\n}\n\nfunction endpointHealth(endpoint: LogicalEndpoint) {\n  if (endpoint.alive_count === 0) return \"text-danger\";\n  if (endpoint.track_instances) {\n    return endpoint.down_count > 0 ? \"text-warning\" : \"text-success\";\n  } else return \"text-success\";\n}\n</script>\n\n<template>\n  <section role=\"table\" aria-label=\"endpoint-instances\">\n    <!--Table headings-->\n    <div role=\"row\" aria-label=\"column-headers\" class=\"row table-head-row\" :style=\"{ borderTop: 0 }\">\n      <ColumnHeader v-if=\"columns.includes(ColumnNames.Name)\" :name=\"ColumnNames.Name\" label=\"Name\" class=\"col-6\" sortable v-model=\"sortByInstances\" default-ascending />\n      <ColumnHeader v-if=\"columns.includes(ColumnNames.InstancesDown)\" :name=\"ColumnNames.InstancesDown\" label=\"Instances Down\" class=\"col-2\" sortable v-model=\"sortByInstances\" default-ascending />\n      <ColumnHeader v-if=\"columns.includes(ColumnNames.InstancesTotal)\" :name=\"ColumnNames.InstancesTotal\" label=\"Instances\" class=\"col-2\" sortable v-model=\"sortByInstances\" default-ascending />\n      <ColumnHeader v-if=\"columns.includes(ColumnNames.LastHeartbeat)\" :name=\"ColumnNames.LastHeartbeat\" label=\"Last Heartbeat\" class=\"col-2\" sortable v-model=\"sortByInstances\" />\n      <ColumnHeader v-if=\"columns.includes(ColumnNames.Tracked)\" :name=\"ColumnNames.Tracked\" label=\"Track Instances\" class=\"col-1 centre\" sortable v-model=\"sortByInstances\" />\n      <ColumnHeader v-if=\"columns.includes(ColumnNames.TrackToggle)\" :name=\"ColumnNames.TrackToggle\" label=\"Track Instances\" class=\"col-2 centre\" sortable v-model=\"sortByInstances\" />\n      <ColumnHeader v-if=\"columns.includes(ColumnNames.Muted)\" :name=\"ColumnNames.Muted\" label=\"Instances Muted\" class=\"col-1 centre\" sortable v-model=\"sortByInstances\" />\n    </div>\n    <!--Table rows-->\n    <DataView :data=\"data\" :show-items-per-page=\"true\" :items-per-page=\"itemsPerPage\" @items-per-page-changed=\"store.setItemsPerPage\">\n      <template #data=\"{ pageData }\">\n        <div role=\"rowgroup\" aria-label=\"endpoints\">\n          <div role=\"row\" :aria-label=\"endpoint.name\" class=\"row grid-row\" v-for=\"endpoint in pageData\" :key=\"endpoint.name\">\n            <div v-if=\"columns.includes(ColumnNames.Name)\" role=\"cell\" aria-label=\"instance-name\" class=\"col-6 host-name\">\n              <div class=\"box-header\">\n                <tippy :aria-label=\"endpoint.name\" :delay=\"[700, 0]\" class=\"no-side-padding lead righ-side-ellipsis endpoint-details-link\">\n                  <template #content>\n                    <p :style=\"{ overflowWrap: 'break-word' }\">{{ endpoint.name }}</p>\n                  </template>\n                  <RouterLink class=\"hackToPreventSafariFromShowingTooltip\" aria-label=\"details-link\" :to=\"{ path: routeLinks.heartbeats.instances.link(endpoint.name), query: { back: route.path } }\">\n                    {{ endpoint.name }}\n                  </RouterLink>\n                </tippy>\n              </div>\n            </div>\n            <div v-if=\"columns.includes(ColumnNames.InstancesTotal) || columns.includes(ColumnNames.InstancesDown)\" role=\"cell\" class=\"col-2\">\n              <tippy :delay=\"[300, 0]\">\n                <template #content>\n                  <template v-if=\"endpoint.track_instances\">\n                    <p>Tracking all instances</p>\n                    <p>{{ endpoint.alive_count }} alive</p>\n                    <p>{{ endpoint.down_count }} no heartbeat</p>\n                  </template>\n                  <template v-else>\n                    <p>Not tracking instances</p>\n                    <p>{{ endpoint.alive_count }} alive</p>\n                  </template>\n                </template>\n                <FAIcon :icon=\"endpoint.track_instances ? faServer : faCloud\" class=\"icon\" :class=\"endpointHealth(endpoint)\" />\n                <span class=\"endpoint-count\" aria-label=\"instance-count\">{{ store.instanceDisplayText(endpoint) }}</span>\n              </tippy>\n            </div>\n            <div v-if=\"columns.includes(ColumnNames.LastHeartbeat)\" role=\"cell\" aria-label=\"last-heartbeat\" class=\"col-2 last-heartbeat\">\n              <LastHeartbeat :date=\"endpoint.heartbeat_information?.last_report_at\" tooltip-target=\"endpoint\" />\n            </div>\n            <div v-if=\"columns.includes(ColumnNames.Tracked)\" role=\"cell\" aria-label=\"tracked-instances\" class=\"col-1 centre\">\n              <tippy v-if=\"endpoint.track_instances\" id=\"tracked-instance-desc\" content=\"Instances are being tracked\" :delay=\"[1000, 0]\">\n                <FAIcon :icon=\"faCheck\" class=\"text-success\" aria-title=\"Instances are being tracked\" />\n              </tippy>\n            </div>\n            <div v-if=\"columns.includes(ColumnNames.TrackToggle)\" role=\"cell\" aria-label=\"tracked-instances\" class=\"col-2 centre\">\n              <div class=\"switch\">\n                <OnOffSwitch :id=\"endpoint.name\" @toggle=\"changeEndpointSettings(endpoint)\" :value=\"endpoint.track_instances\" />\n              </div>\n            </div>\n            <div v-if=\"columns.includes(ColumnNames.Muted)\" role=\"cell\" aria-label=\"muted\" class=\"col-1 centre\">\n              <template v-if=\"endpoint.muted_count === endpoint.alive_count + endpoint.down_count\">\n                <tippy content=\"All instances have alerts muted\" :delay=\"[300, 0]\">\n                  <FAIcon :icon=\"faBellSlash\" class=\"text-danger\" />\n                </tippy>\n                <span class=\"instances-muted\" aria-label=\"Muted instance count\">{{ endpoint.muted_count }}</span>\n              </template>\n              <template v-else-if=\"endpoint.muted_count > 0\">\n                <tippy :content=\"`${endpoint.muted_count} instance(s) have alerts muted`\" :delay=\"[300, 0]\">\n                  <FAIcon :icon=\"faBellSlash\" class=\"text-warning\" />\n                </tippy>\n                <span class=\"instances-muted\">{{ endpoint.muted_count }}</span>\n              </template>\n            </div>\n          </div>\n        </div>\n      </template>\n    </DataView>\n  </section>\n</template>\n\n<style scoped>\n@import \"../list.css\";\n@import \"./heartbeats.css\";\n\n.hackToPreventSafariFromShowingTooltip::after {\n  content: \"\";\n  display: block;\n}\n\n.instances-muted {\n  font-weight: bold;\n}\n\n.icon {\n  padding-right: 6px;\n}\n</style>\n"],"names":["store","useHeartbeatsStoreAutoRefresh","sortByInstances","itemsPerPage","storeToRefs","route","useRoute","changeEndpointSettings","endpoint","useShowToast","TYPE","endpointHealth","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","__props","_unref","ColumnNames","_createBlock","ColumnHeader","$event","_createVNode","DataView","_withCtx","pageData","_hoisted_3","_Fragment","_renderList","_hoisted_5","_hoisted_6","Tippy","_hoisted_7","_toDisplayString","_component_RouterLink","routeLinks","_createTextVNode","_hoisted_8","_cache","FAIcon","faServer","faCloud","_normalizeClass","_hoisted_9","_hoisted_10","LastHeartbeat","_hoisted_11","faCheck","_hoisted_12","_hoisted_13","OnOffSwitch","_hoisted_14","faBellSlash","_hoisted_15","_hoisted_16"],"mappings":"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"}