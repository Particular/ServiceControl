import{e as R,by as q,u as L,r as v,s as A,m as a,n as c,q as o,a7 as _,y as t,t as r,z as s,v as u,ao as m,_ as d,ae as k,E as T,a3 as U,a8 as N,U as B}from"./index-Cy3_77ur.js";const W={name:"connections"},$={class:"box"},z={class:"row"},D={class:"col-12"},X={novalidate:""},j={class:"row connection"},F={class:"col-7 form-group"},G={for:"serviceControlUrl"},H={key:0,class:"failed-validation"},J={class:"col-5 no-side-padding"},K={key:0,class:"connection-test connection-testing"},Q={key:1,class:"connection-test connection-successful"},Y={key:2,class:"connection-test connection-failed"},Z={class:"row connection"},nn={class:"col-7 form-group"},on={for:"monitoringUrl"},en={key:0,class:"failed-validation"},tn={class:"col-5 no-side-padding"},sn=["disabled"],ln={key:0,class:"connection-test connection-testing"},an={key:1,class:"connection-test connection-successful"},cn={key:2,class:"connection-test connection-failed"},rn={class:"connection-test connection-successful hide save-connection"},un={class:"connection-test connection-failed hide save-connection"},dn=R({__name:"PlatformConnections",setup(vn){const{store:h}=q(),x=h.connectionState,V=h.monitoringConnectionState,C=L();C.refresh();const l=v(C.serviceControlUrl),e=v(C.monitoringUrl),{isMonitoringDisabled:E}=A(C),f=v(!1),b=v(null),p=v(!1),g=v(null),y=v(null);async function M(){if(l.value){f.value=!0;try{const i=await fetch(l.value);b.value=i.ok&&i.headers.has("X-Particular-Version")}catch{b.value=!1}finally{f.value=!1}}}async function I(){if(e.value){p.value=!0,!e.value.endsWith("/")&&e.value!=="!"&&(e.value+="/");try{const i=await fetch(e.value+"monitored-endpoints");g.value=i.ok&&i.headers.has("X-Particular-Version")}catch{g.value=!1}finally{p.value=!1}}}function w(){return e.value&&e.value!=="!"}function O(){P(),y.value=!0}function P(){if(l.value)l.value.endsWith("/")||(l.value+="/");else throw new Error("ServiceControl URL is mandatory");e.value?!e.value.endsWith("/")&&e.value!=="!"&&(e.value+="/"):e.value="!",window.localStorage.removeItem("scu"),window.localStorage.removeItem("mu");const i=`?scu=${l.value}&mu=${e.value}`;console.debug("updateConnections - new query string: ",i),window.location.search=i}return(i,n)=>(c(),a("section",W,[o("div",$,[o("div",z,[o("div",D,[o("form",X,[o("div",j,[n[7]||(n[7]=o("h3",null,"ServiceControl",-1)),o("div",F,[o("label",G,[n[3]||(n[3]=t(" CONNECTION URL ",-1)),s(x).unableToConnect?(c(),a("span",H,[u(d,{icon:s(m)},null,8,["icon"]),n[2]||(n[2]=t(" Unable to connect ",-1))])):r("",!0)]),_(o("input",{type:"text",id:"serviceControlUrl",name:"serviceControlUrl","onUpdate:modelValue":n[0]||(n[0]=S=>l.value=S),class:"form-control",style:{color:"#000"},required:""},null,512),[[k,l.value]])]),o("div",J,[o("button",{class:T(["btn btn-default btn-secondary btn-connection-test",{disabled:!l.value}]),type:"button",onClick:M},"Test",2),f.value?(c(),a("span",K,[...n[4]||(n[4]=[o("i",{class:"glyphicon glyphicon-refresh rotate"},null,-1),t("Testing ",-1)])])):r("",!0),b.value===!0&&!f.value?(c(),a("span",Q,[u(d,{icon:s(U)},null,8,["icon"]),n[5]||(n[5]=t(" Connection successful ",-1))])):r("",!0),b.value===!1&&!f.value?(c(),a("span",Y,[u(d,{icon:s(m)},null,8,["icon"]),n[6]||(n[6]=t(" Connection failed ",-1))])):r("",!0)])]),o("div",Z,[n[14]||(n[14]=o("h3",null,"ServiceControl Monitoring",-1)),o("div",nn,[o("label",on,[n[9]||(n[9]=t(" CONNECTION URL ",-1)),n[10]||(n[10]=o("span",{class:"auxilliary-label"},"(OPTIONAL) (Enter ! to disable monitoring)",-1)),s(V).unableToConnect&&!s(E)?(c(),a("span",en,[u(d,{icon:s(m)},null,8,["icon"]),n[8]||(n[8]=t(" Unable to connect ",-1))])):r("",!0)]),_(o("input",{type:"text",id:"monitoringUrl",name:"monitoringUrl","onUpdate:modelValue":n[1]||(n[1]=S=>e.value=S),class:"form-control",required:""},null,512),[[k,e.value]])]),o("div",tn,[o("button",{class:T(["btn btn-default btn-secondary btn-connection-test",{disabled:!w()}]),type:"button",onClick:I,disabled:!w()},"Test",10,sn),p.value?(c(),a("span",ln,[...n[11]||(n[11]=[o("i",{class:"glyphicon glyphicon-refresh rotate"},null,-1),t("Testing ",-1)])])):r("",!0),g.value===!0&&!p.value?(c(),a("span",an,[u(d,{icon:s(U)},null,8,["icon"]),n[12]||(n[12]=t(" Connection successful ",-1))])):r("",!0),g.value===!1&&!p.value?(c(),a("span",cn,[u(d,{icon:s(m)},null,8,["icon"]),n[13]||(n[13]=t(" Connection failed ",-1))])):r("",!0)])]),o("button",{class:"btn btn-primary",type:"button",onClick:O},"Save"),_(o("span",rn,[u(d,{icon:s(U)},null,8,["icon"]),n[15]||(n[15]=t(" Connection saved ",-1))],512),[[N,y.value]]),_(o("span",un,[u(d,{icon:s(m)},null,8,["icon"]),n[16]||(n[16]=t(" Unable to save ",-1))],512),[[N,y.value!=null&&!y.value]])])])])])]))}}),pn=B(dn,[["__scopeId","data-v-4b93eeef"]]);export{pn as default};
//# sourceMappingURL=PlatformConnections-BUpIALIS.js.map
