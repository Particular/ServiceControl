{"version":3,"file":"HeartbeatConfiguration-B3eWyLtA.js","sources":["../../../../frontend/src/components/heartbeats/EndpointSettingsSupported.vue","../../../../frontend/src/components/heartbeats/HeartbeatConfiguration.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport ConditionalRender from \"@/components/ConditionalRender.vue\";\nimport useIsEndpointSettingsSupported, { minimumSCVersionForEndpointSettings } from \"@/components/heartbeats/isEndpointSettingsSupported\";\n\nconst isEndpointSettingsSupported = useIsEndpointSettingsSupported();\n</script>\n\n<template>\n  <ConditionalRender :supported=\"isEndpointSettingsSupported\">\n    <template #unsupported>\n      <div class=\"container not-supported\">\n        <div class=\"row\">\n          <div class=\"col-sm-12\">\n            <div class=\"text-center message\">\n              <p>\n                The minimum version of ServiceControl required to enable configuring tracking of endpoints is\n                <span> {{ minimumSCVersionForEndpointSettings }} </span>.\n              </p>\n              <div>\n                <a class=\"btn btn-default btn-primary\" href=\"https://particular.net/downloads\" target=\"_blank\">Update ServiceControl to latest version</a>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </template>\n    <slot />\n  </ConditionalRender>\n</template>\n\n<style scoped>\n@import \"@/components/notsupported.css\";\n</style>\n","<script setup lang=\"ts\">\nimport { ColumnNames } from \"@/stores/HeartbeatsStore\";\nimport { storeToRefs } from \"pinia\";\nimport NoData from \"../NoData.vue\";\nimport { useShowToast } from \"@/composables/toast\";\nimport { TYPE } from \"vue-toastification\";\nimport EndpointSettingsSupported from \"@/components/heartbeats/EndpointSettingsSupported.vue\";\nimport OnOffSwitch from \"../OnOffSwitch.vue\";\nimport HeartbeatsList from \"./HeartbeatsList.vue\";\nimport { ref } from \"vue\";\nimport ConfirmDialog from \"@/components/ConfirmDialog.vue\";\nimport ResultsCount from \"../ResultsCount.vue\";\nimport FAIcon from \"@/components/FAIcon.vue\";\nimport { faCloud, faServer } from \"@fortawesome/free-solid-svg-icons\";\nimport useHeartbeatsStoreAutoRefresh from \"@/composables/useHeartbeatsStoreAutoRefresh\";\n\nenum Operation {\n  Track = \"track\",\n  DoNotTrack = \"do not track\",\n}\n\nconst { store } = useHeartbeatsStoreAutoRefresh();\nconst { sortedEndpoints, filteredEndpoints, defaultTrackingInstancesValue } = storeToRefs(store);\nconst showBulkWarningDialog = ref(false);\nconst dialogWarningOperation = ref(Operation.Track);\n\nfunction showBulkOperationWarningDialog(operation: Operation) {\n  dialogWarningOperation.value = operation;\n  showBulkWarningDialog.value = true;\n}\n\nfunction cancelWarningDialog() {\n  showBulkWarningDialog.value = false;\n}\n\nasync function proceedWarningDialog() {\n  showBulkWarningDialog.value = false;\n\n  try {\n    await store.updateEndpointSettings(\n      filteredEndpoints.value.filter((endpoint) => (dialogWarningOperation.value === Operation.Track && !endpoint.track_instances) || (dialogWarningOperation.value === Operation.DoNotTrack && endpoint.track_instances))\n    );\n    useShowToast(TYPE.SUCCESS, `All endpoints set to '${dialogWarningOperation.value}'`, \"\", false, { timeout: 1000 });\n  } catch {\n    useShowToast(TYPE.ERROR, \"Save failed\", \"\", false, { timeout: 3000 });\n  }\n}\n\nasync function toggleDefaultSetting() {\n  try {\n    await store.updateEndpointSettings([{ name: \"\", track_instances: defaultTrackingInstancesValue.value }]);\n    useShowToast(TYPE.SUCCESS, \"Default setting updated\", \"\", false, { timeout: 3000 });\n  } catch {\n    useShowToast(TYPE.ERROR, \"Failed to update default setting\", \"\", false, { timeout: 3000 });\n  }\n}\n</script>\n\n<template>\n  <EndpointSettingsSupported>\n    <Teleport to=\"#modalDisplay\">\n      <ConfirmDialog\n        v-if=\"showBulkWarningDialog\"\n        heading=\"Proceed with bulk operation\"\n        :body=\"`Are you sure you want to set ${filteredEndpoints.length} endpoint(s) to be '${dialogWarningOperation}'?`\"\n        @cancel=\"cancelWarningDialog\"\n        @confirm=\"proceedWarningDialog\"\n      />\n    </Teleport>\n    <div class=\"row filters\">\n      <div class=\"col-sm-12\">\n        <span class=\"buttonsContainer\">\n          <button type=\"button\" class=\"btn btn-default btn-sm\" :disabled=\"filteredEndpoints.length === 0\" @click=\"showBulkOperationWarningDialog(Operation.Track)\">\n            <FAIcon :icon=\"faServer\" class=\"icon\" :class=\"{ 'text-black': filteredEndpoints.length > 0 }\" />\n            Track Instances on All Endpoints\n          </button>\n          <button type=\"button\" class=\"btn btn-default btn-sm\" :disabled=\"filteredEndpoints.length === 0\" @click=\"showBulkOperationWarningDialog(Operation.DoNotTrack)\">\n            <FAIcon :icon=\"faCloud\" class=\"icon\" :class=\"{ 'text-black': filteredEndpoints.length > 0 }\" />\n            Do Not Track Instances on All Endpoints\n          </button>\n        </span>\n      </div>\n    </div>\n    <div class=\"row\">\n      <ResultsCount :displayed=\"filteredEndpoints.length\" :total=\"sortedEndpoints.length\" />\n    </div>\n    <section name=\"endpoint_configuration\" aria-label=\"Endpoint Configuration\">\n      <div class=\"row\">\n        <div class=\"col-9 no-side-padding\">\n          <no-data v-if=\"sortedEndpoints.length === 0\" message=\"Nothing to configure\" />\n          <div v-else class=\"row no-side-padding\">\n            <HeartbeatsList :data=\"filteredEndpoints\" :columns=\"[ColumnNames.Name, ColumnNames.InstancesTotal, ColumnNames.LastHeartbeat, ColumnNames.TrackToggle]\" />\n          </div>\n        </div>\n        <div class=\"col-3 instructions\">\n          <div class=\"defaultSetting\">\n            <label>Track Instances by default on new endpoints</label>\n            <div class=\"switch\">\n              <OnOffSwitch id=\"defaultTIV\" @toggle=\"toggleDefaultSetting\" :value=\"defaultTrackingInstancesValue\" />\n            </div>\n          </div>\n          <p>\n            <template v-if=\"defaultTrackingInstancesValue\">If most of your endpoints are auto-scaled, consider changing this setting.</template>\n            <template v-else>If most of your endpoint are hosted in physical infrastructure, consider changing this setting.</template>\n          </p>\n          <p><code>Track Instances</code> is the best setting for endpoints where all instances are hosted in physical infrastructure that is not auto-scaled. Example, physical or virtual servers.</p>\n          <p><code>Do Not Track Instances</code> is the best setting for endpoints that are hosted in infrastructure with autoscalers. Example, Kubernetes, Azure Container Apps and AWS Elastic Container Service.</p>\n        </div>\n      </div>\n    </section>\n  </EndpointSettingsSupported>\n</template>\n\n<style scoped>\n.instructions {\n  padding: 10px;\n}\n\n.instructions p {\n  color: unset;\n}\n.defaultSetting {\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n  gap: 1em;\n  line-height: 1em;\n}\n\n.defaultSetting .switch {\n  margin-top: -8px;\n}\n\n.instructions > div {\n  margin-bottom: 5px;\n}\n\n.filters {\n  margin-top: 0.25em;\n  margin-bottom: 0.25em;\n}\n\n.buttonsContainer {\n  background-color: #f3f3f3;\n  display: flex;\n  gap: 0.5em;\n  border: #8c8c8c 1px solid;\n  border-radius: 3px;\n  padding: 0.4em;\n}\n\n.icon {\n  color: var(--reduced-emphasis);\n}\n</style>\n"],"names":["isEndpointSettingsSupported","useIsEndpointSettingsSupported","_createBlock","ConditionalRender","_unref","_createElementVNode","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","minimumSCVersionForEndpointSettings","_renderSlot","_ctx","store","useHeartbeatsStoreAutoRefresh","sortedEndpoints","filteredEndpoints","defaultTrackingInstancesValue","storeToRefs","showBulkWarningDialog","ref","dialogWarningOperation","showBulkOperationWarningDialog","operation","cancelWarningDialog","proceedWarningDialog","endpoint","useShowToast","TYPE","toggleDefaultSetting","EndpointSettingsSupported","_Teleport","ConfirmDialog","_cache","$event","_createVNode","FAIcon","faServer","_normalizeClass","faCloud","_hoisted_6","ResultsCount","_hoisted_7","_hoisted_8","_hoisted_9","NoData","_openBlock","_createElementBlock","_hoisted_10","HeartbeatsList","ColumnNames","_hoisted_11","_hoisted_12","_hoisted_13","OnOffSwitch","_Fragment"],"mappings":"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"}