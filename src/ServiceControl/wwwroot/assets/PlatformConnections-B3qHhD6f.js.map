{"version":3,"file":"PlatformConnections-B3qHhD6f.js","sources":["../../../../frontend/src/components/configuration/PlatformConnections.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ref } from \"vue\";\nimport { faCheck, faExclamationTriangle } from \"@fortawesome/free-solid-svg-icons\";\nimport FAIcon from \"@/components/FAIcon.vue\";\nimport useConnectionsAndStatsAutoRefresh from \"@/composables/useConnectionsAndStatsAutoRefresh\";\nimport { useServiceControlStore } from \"@/stores/ServiceControlStore\";\nimport { storeToRefs } from \"pinia\";\n\nconst { store: connectionStore } = useConnectionsAndStatsAutoRefresh();\nconst monitoringConnectionState = connectionStore.monitoringConnectionState;\nconst serviceControlStore = useServiceControlStore();\nconst localMonitoringUrl = ref(serviceControlStore.monitoringUrl);\nconst { isMonitoringDisabled } = storeToRefs(serviceControlStore);\nconst testingMonitoring = ref(false);\nconst monitoringValid = ref<boolean | null>(null);\nconst connectionSaved = ref<boolean | null>(null);\n\nserviceControlStore.refresh();\n\nasync function testMonitoringUrl() {\n  if (localMonitoringUrl.value) {\n    testingMonitoring.value = true;\n\n    if (!localMonitoringUrl.value.endsWith(\"/\") && localMonitoringUrl.value !== \"!\") {\n      localMonitoringUrl.value += \"/\";\n    }\n\n    try {\n      const response = await fetch(localMonitoringUrl.value + \"monitored-endpoints\");\n      monitoringValid.value = response.ok && response.headers.has(\"X-Particular-Version\");\n    } catch {\n      monitoringValid.value = false;\n    } finally {\n      testingMonitoring.value = false;\n    }\n  }\n}\n\nfunction isMonitoringUrlSpecified() {\n  return localMonitoringUrl.value && localMonitoringUrl.value !== \"!\";\n}\n\nfunction saveConnections() {\n  updateServiceControlUrls();\n  connectionSaved.value = true;\n}\n\nfunction updateServiceControlUrls() {\n  if (!localMonitoringUrl.value) {\n    localMonitoringUrl.value = \"!\"; //disabled\n  } else if (!localMonitoringUrl.value.endsWith(\"/\") && localMonitoringUrl.value !== \"!\") {\n    localMonitoringUrl.value += \"/\";\n  }\n\n  //values have changed. They'll be reset after page reloads\n  window.localStorage.removeItem(\"mu\");\n\n  const newSearch = `?mu=${localMonitoringUrl.value}`;\n  console.debug(\"updateConnections - new query string: \", newSearch);\n  window.location.search = newSearch;\n}\n</script>\n\n<template>\n  <section name=\"connections\">\n    <div class=\"box\">\n      <div class=\"row\">\n        <div class=\"col-12\">\n          <form novalidate>\n            <div class=\"row connection\">\n              <h3>ServiceControl Monitoring</h3>\n              <div class=\"col-7 form-group\">\n                <label for=\"monitoringUrl\">\n                  CONNECTION URL\n                  <span class=\"auxilliary-label\">(OPTIONAL) (Enter ! to disable monitoring)</span>\n                  <template v-if=\"monitoringConnectionState.unableToConnect && !isMonitoringDisabled\">\n                    <span class=\"failed-validation\"><FAIcon :icon=\"faExclamationTriangle\" /> Unable to connect </span>\n                  </template>\n                </label>\n                <input type=\"text\" id=\"monitoringUrl\" name=\"monitoringUrl\" v-model=\"localMonitoringUrl\" class=\"form-control\" required />\n              </div>\n\n              <div class=\"col-5 no-side-padding\">\n                <button class=\"btn btn-default btn-secondary btn-connection-test\" :class=\"{ disabled: !isMonitoringUrlSpecified() }\" type=\"button\" @click=\"testMonitoringUrl\" :disabled=\"!isMonitoringUrlSpecified()\">Test</button>\n                <span class=\"connection-test connection-testing\" v-if=\"testingMonitoring\"> <i class=\"glyphicon glyphicon-refresh rotate\"></i>Testing </span>\n                <span class=\"connection-test connection-successful\" v-if=\"monitoringValid === true && !testingMonitoring\"><FAIcon :icon=\"faCheck\" /> Connection successful </span>\n                <span class=\"connection-test connection-failed\" v-if=\"monitoringValid === false && !testingMonitoring\"><FAIcon :icon=\"faExclamationTriangle\" /> Connection failed </span>\n              </div>\n            </div>\n\n            <button class=\"btn btn-primary\" type=\"button\" @click=\"saveConnections\">Save</button>\n            <span class=\"connection-test connection-successful hide save-connection\" v-show=\"connectionSaved\"><FAIcon :icon=\"faCheck\" /> Connection saved </span>\n            <span class=\"connection-test connection-failed hide save-connection\" v-show=\"connectionSaved != null && !connectionSaved\"><FAIcon :icon=\"faExclamationTriangle\" /> Unable to save </span>\n          </form>\n        </div>\n      </div>\n    </div>\n  </section>\n</template>\n\n<style scoped>\nsection[name=\"connections\"] .box {\n  padding-bottom: 50px;\n}\n\nform .connection h3 {\n  margin-bottom: 16px;\n  margin-top: 25px;\n  padding-left: 0;\n}\n\nform .connection .form-group {\n  padding-left: 0;\n}\n\n.connection:nth-child(2) h3 {\n  margin-top: 40px;\n}\n\nform .connection .form-group input {\n  font-size: 16px;\n  height: 44px;\n}\n\n.row.connection {\n  margin-left: 0;\n}\n\nspan.connection-test.save-connection {\n  top: 0;\n}\n\n.btn-connection-test {\n  margin-top: 25px;\n  padding-top: 11px;\n  padding-bottom: 11px;\n}\n</style>\n"],"names":["connectionStore","useConnectionsAndStatsAutoRefresh","monitoringConnectionState","serviceControlStore","useServiceControlStore","localMonitoringUrl","ref","isMonitoringDisabled","storeToRefs","testingMonitoring","monitoringValid","connectionSaved","testMonitoringUrl","response","isMonitoringUrlSpecified","saveConnections","updateServiceControlUrls","newSearch","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_cache","_hoisted_7","_hoisted_8","_unref","_hoisted_9","_createVNode","FAIcon","faExclamationTriangle","$event","_hoisted_10","_normalizeClass","_hoisted_11","_hoisted_12","_hoisted_13","faCheck","_hoisted_14","_withDirectives","_hoisted_15","_hoisted_16","_vShow"],"mappings":"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"}