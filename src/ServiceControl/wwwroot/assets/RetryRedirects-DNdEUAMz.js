import{e as A,r as k,c as I,l as H,aM as G,m as c,n as r,q as s,t as v,a7 as S,v as m,_ as O,z as b,aE as B,E as T,aH as X,K as P,L,B as M,aN as j,p as C,x as w,y as p,ah as Q,U as K,bw as J,u as W,c1 as Z,o as ee,aq as se,bf as te,N as ae,ac as re,a6 as oe,T as U,C as le,am as ie,ax as de,P as f,Q as y}from"./index-tFZp7u44.js";const ue={class:"modal-mask"},ne={class:"modal-wrapper"},ce={class:"modal-container modal-content"},me={class:"modal-header"},ve={key:0,class:"modal-title"},_e={key:1,class:"modal-title"},fe={name:"redirectForm",class:"redirectForm",novalidate:""},ye={class:"modal-body"},pe={class:"row"},ge={class:"form-group"},he=["disabled"],Re=["value"],Ce={class:"form-group"},ke={class:"form-group"},we={class:"modal-footer"},qe="Choose a queue that is known to Service Control",be="Choose a queue that is known to Service Control or provide a custom queue",Qe=A({__name:"RetryRedirectEdit",props:{message_redirect_id:{},from_physical_address:{},to_physical_address:{},immediately_retry:{type:Boolean,default:!1},queues:{}},emits:["create","edit","cancel"],setup(z,{emit:x}){const $=x,o=z,u=k(o.from_physical_address),i=k(o.to_physical_address),g=k(o.immediately_retry),h=I(()=>!!u.value),_=I(()=>i.value&&i.value!==u.value),d=I(()=>h.value&&_.value),l=I(()=>!o.queues.includes(i.value)),q=I(()=>o.queues.length===0);function D(R){i.value=R}function V(){const R={redirectId:"",sourceQueue:u.value,targetQueue:i.value,immediatelyRetry:g.value};$("create",R)}function F(){const R={redirectId:o.message_redirect_id,sourceQueue:u.value,targetQueue:i.value,immediatelyRetry:g.value};$("edit",R)}function N(){$("cancel")}return(R,a)=>{const E=H("vue3-simple-typeahead"),t=G("tippy");return r(),c("div",ue,[s("div",ne,[s("div",ce,[s("div",me,[o.message_redirect_id?(r(),c("h3",ve,"Modify redirect")):v("",!0),o.message_redirect_id?v("",!0):(r(),c("h3",_e,"Create redirect"))]),s("form",fe,[s("div",ye,[s("div",pe,[s("div",ge,[a[3]||(a[3]=s("label",{for:"sourceQueue"},"From physical address",-1)),S(m(O,{icon:b(B),class:"info",size:"sm"},null,8,["icon"]),[[t,qe]]),s("div",{class:T({"has-error":!h.value,"has-success":h.value})},[S(s("select",{id:"sourceQueue",name:"sourceQueue","onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),class:"form-select",required:"",disabled:!!o.message_redirect_id},[(r(!0),c(P,null,L(o.queues,e=>(r(),c("option",{value:e,key:e},M(e),9,Re))),128))],8,he),[[X,u.value]])],2)]),a[8]||(a[8]=s("div",{class:"row"},null,-1)),s("div",Ce,[a[6]||(a[6]=s("label",{for:"targetQueue"},"To physical address",-1)),S(m(O,{icon:b(B),class:"info",size:"sm"},null,8,["icon"]),[[t,be]]),s("div",{class:T({"has-error":!_.value,"has-success":_.value})},[m(E,{id:"targetQueue",name:"targetQueue",defaultItem:o.to_physical_address,modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),onSelectItem:D,class:"form-control",required:"",placeholder:"Start writing...",items:o.queues,minInputLength:1},null,8,["defaultItem","modelValue","items"]),q.value?(r(),c("div",{key:0,class:T({"has-error":q.value})},[...a[4]||(a[4]=[s("p",{class:"control-label"},"No known queues found. You can enter a queue name manually, but if you don't provide a valid address, the redirected message will be lost.",-1)])],2)):v("",!0),l.value?(r(),c("div",{key:1,class:T({"has-error":l.value})},[...a[5]||(a[5]=[s("p",{class:"control-label"},"Target queue does not match any known queue. You can enter a queue name manually, but if you don't provide a valid address, the redirected message will be lost.",-1)])],2)):v("",!0)],2)]),s("div",ke,[S(s("input",{type:"checkbox","onUpdate:modelValue":a[2]||(a[2]=e=>g.value=e),class:"check-label",id:"immediatelyRetry"},null,512),[[j,g.value]]),a[7]||(a[7]=s("label",{for:"immediatelyRetry"},"Immediately retry any matching failed messages",-1))])])]),s("div",we,[o.message_redirect_id?(r(),C(Q,{key:0,variant:"primary",disabled:!d.value,onClick:F},{default:w(()=>[...a[9]||(a[9]=[p("Modify",-1)])]),_:1},8,["disabled"])):v("",!0),o.message_redirect_id?v("",!0):(r(),C(Q,{key:1,variant:"primary",disabled:!d.value,onClick:V},{default:w(()=>[...a[10]||(a[10]=[p("Create",-1)])]),_:1},8,["disabled"])),m(Q,{onClick:N},{default:w(()=>[...a[11]||(a[11]=[p("Cancel",-1)])]),_:1})])])])])])}}}),$e=K(Qe,[["__scopeId","data-v-2c4cd74a"]]),Ee={name:"redirects"},Ie={class:"row"},Se={class:"col-sm-12"},Te={class:"btn-toolbar"},xe={class:"row"},De={key:0,class:"col-sm-12"},Ve={class:"row",id:"{{redirect.from_physical_address}}"},Fe={class:"col-sm-12"},Ne=["title"],Oe=["title"],Me={class:"metadata"},ze={class:"row"},Be={class:"col-sm-12"},Ue={class:"small"},Ae=A({__name:"RetryRedirects",setup(z){const{store:x}=J(),$=x.serviceControlIsGreaterThan("5.2.0"),o=W(),u=Z(),i=k(!0),g=u.redirects,h=k(!1),_=k(!1),d=k({message_redirect_id:"",from_physical_address:"",to_physical_address:"",last_modified:"",queues:[]}),l=k(null);async function q(){i.value=!0,await u.refresh(),d.value.queues=u.redirects.queues,i.value=!1}function D(){l.value=null,d.value.message_redirect_id="",d.value.from_physical_address="",d.value.to_physical_address="",_.value=!0}function V(t){l.value=null,d.value.message_redirect_id=t.message_redirect_id,d.value.from_physical_address=t.from_physical_address,d.value.to_physical_address=t.to_physical_address,_.value=!0}async function F(t){l.value=null,_.value=!1;const e=E(await o.putToServiceControl(`redirects/${t.redirectId}`,{id:t.redirectId,fromphysicaladdress:t.sourceQueue,tophysicaladdress:t.targetQueue}));return e.message==="success"?(l.value=!0,f(y.INFO,"Info","Redirect updated successfully"),q()):(l.value=!1,e.status===409?f(y.ERROR,"Error","Failed to update a redirect, can not create redirect to a queue"+t.targetQueue+" as it already has a redirect. Provide a different queue or end the redirect."):f(y.ERROR,"Error",e.message)),e.message==="success"&&t.immediatelyRetry?u.retryPendingMessagesForQueue(t.sourceQueue):e}async function N(t){l.value=null,_.value=!1;const e=E(await o.postToServiceControl("redirects",{fromphysicaladdress:t.sourceQueue,tophysicaladdress:t.targetQueue}));e.message==="success"?(l.value=!0,f(y.INFO,"Info","Redirect created successfully"),q()):(l.value=!1,e.status===409&&e.statusText==="Duplicate"?f(y.ERROR,"Error","Failed to create a redirect, can not create more than one redirect for queue: "+t.sourceQueue):e.status===409&&e.statusText==="Dependents"?f(y.ERROR,"Error","Failed to create a redirect, can not create a redirect to a queue that already has a redirect or is a target of a redirect."):f(y.ERROR,"Error",e.message))}function R(t){l.value=null,d.value.message_redirect_id=t.message_redirect_id,h.value=!0}async function a(){const t=E(await o.deleteFromServiceControl(`redirects/${d.value.message_redirect_id}`));t.message==="success"?(l.value=!0,f(y.INFO,"Info","Redirect deleted"),await q()):(l.value=!1,f(y.ERROR,"Error",t.message))}ee(()=>{q()});function E(t){const e=$.value?t.headers.get("X-Particular-Reason"):t.statusText;return{message:t.ok?"success":`error:${t.statusText}`,status:t.status,statusText:e,data:t}}return(t,e)=>(r(),c("section",Ee,[m(de,null,{default:w(()=>[m(se,null,{default:w(()=>[s("section",null,[i.value?(r(),C(te,{key:0})):v("",!0),s("div",Ie,[s("div",Se,[s("div",Te,[m(Q,{onClick:D},{default:w(()=>[...e[3]||(e[3]=[s("i",{class:"fa pa-redirect-source pa-redirect-small"},null,-1),p(" Create Redirect",-1)])]),_:1}),e[4]||(e[4]=s("span",null,null,-1))])])]),b(g).total===0&&!i.value?(r(),C(ae,{key:1,title:"Redirects",message:"There are currently no redirects"})):v("",!0),s("div",xe,[b(g).total>0?(r(),c("div",De,[(r(!0),c(P,null,L(b(g).data,n=>(r(),c("div",{key:n.message_redirect_id,class:"row box repeat-modify"},[s("div",Ve,[s("div",Fe,[s("p",{class:"lead hard-wrap truncate",title:n.from_physical_address},[e[5]||(e[5]=s("i",{class:"fa pa-redirect-source pa-redirect-small",title:"Source queue name"},null,-1)),p(" "+M(n.from_physical_address),1)],8,Ne),s("p",{class:"lead hard-wrap truncate",title:n.to_physical_address},[e[6]||(e[6]=s("i",{class:"fa pa-redirect-destination pa-redirect-small",title:"Destination queue name"},null,-1)),p(" "+M(n.to_physical_address),1)],8,Oe),s("p",Me,[m(O,{icon:b(re),size:"sm",class:"icon"},null,8,["icon"]),e[7]||(e[7]=p(" Last modified: ",-1)),m(oe,{dateUtc:n.last_modified},null,8,["dateUtc"])])])]),s("div",ze,[s("div",Be,[s("p",Ue,[m(Q,{variant:"link",size:"sm",onClick:Y=>R(n)},{default:w(()=>[...e[8]||(e[8]=[p("End Redirect",-1)])]),_:1},8,["onClick"]),m(Q,{variant:"link",size:"sm",onClick:Y=>V(n)},{default:w(()=>[...e[9]||(e[9]=[p("Modify Redirect",-1)])]),_:1},8,["onClick"])])])])]))),128))])):v("",!0)]),(r(),C(U,{to:"#modalDisplay"},[h.value?(r(),C(le,{key:0,onCancel:e[0]||(e[0]=n=>h.value=!1),onConfirm:e[1]||(e[1]=n=>{h.value=!1,a()}),heading:"Are you sure you want to end the redirect?",body:"Once the redirect is ended, any affected messages will be sent to the original destination queue. Ensure this queue is ready to accept messages again."})):v("",!0)])),(r(),C(U,{to:"#modalDisplay"},[_.value?(r(),C($e,ie({key:0},d.value,{onCancel:e[2]||(e[2]=n=>_.value=!1),onCreate:N,onEdit:F}),null,16)):v("",!0)]))])]),_:1})]),_:1})]))}}),Le=K(Ae,[["__scopeId","data-v-9ed2a027"]]);export{Le as default};
//# sourceMappingURL=RetryRedirects-DNdEUAMz.js.map
