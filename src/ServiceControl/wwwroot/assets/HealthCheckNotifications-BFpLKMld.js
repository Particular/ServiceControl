import{e as M,r,c as x,m as S,n as p,q as t,ai as G,E as $,a7 as y,ae as T,aN as K,y as _,U as q,d as Q,u as X,b$ as Y,s as j,o as J,v as f,x as U,p as A,aq as W,z as g,t as h,K as k,_ as N,ao as P,ah as R,c0 as tt,ab as et,a3 as B,T as st,am as ot,ax as at,P as F,Q as H}from"./index-C-3C3fiy.js";import{O as nt}from"./OnOffSwitch-CdRopK6h.js";const lt={class:"modal-mask"},it={class:"modal-wrapper"},rt={class:"modal-container modal-content"},ut={class:"modal-body"},ct={class:"row"},dt={class:"form-group"},mt={class:"form-group"},vt={class:"form-group"},ft={class:"modal-footer"},pt=["disabled"],_t=M({__name:"HealthCheckNotifications_ConfigureEmail",props:{enabled:{type:[Boolean,null]},enable_tls:{type:[Boolean,null]},smtp_server:{},smtp_port:{},authentication_account:{},authentication_password:{},from:{},to:{}},emits:["save","cancel"],setup(m,{emit:u}){const C=u,n=m,c=r(n.smtp_server),d=r(n.smtp_port),i=r(n.authentication_account),v=r(n.authentication_password),b=r(n.enable_tls),s=r(n.from),a=r(n.to),E=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,w=x(()=>!!c.value),o=x(()=>!!(d.value??!1)),I=x(()=>!!(s.value&&E.test(s.value))),z=x(()=>!!(a.value&&D(a.value))),O=x(()=>w.value&&o.value&&I.value&&z.value);function D(V){return V.split(",").every(l=>E.test(l))}function L(){const V={smtp_server:c.value,smtp_port:d.value??0,authorization_account:i.value,authorization_password:v.value,enable_tls:b.value??!1,from:s.value,to:a.value};C("save",V)}function Z(){C("cancel")}return(V,e)=>(p(),S("div",lt,[t("div",it,[t("div",rt,[e[20]||(e[20]=t("div",{class:"modal-header"},[t("h3",{class:"modal-title"},"Email configuration")],-1)),t("form",{name:"notificationsForm",class:"notificationsForm",novalidate:"",onSubmit:G(L,["prevent"])},[t("div",ut,[t("div",ct,[t("div",{class:$(["form-group",{"has-error":!w.value}])},[e[7]||(e[7]=t("label",{for:"smtpServerAddress"},"SMTP server address",-1)),y(t("input",{type:"text",id:"smtpServerAddress",name:"smtpServerAddress","onUpdate:modelValue":e[0]||(e[0]=l=>c.value=l),class:"form-control",required:""},null,512),[[T,c.value]])],2),e[14]||(e[14]=t("div",{class:"row"},null,-1)),t("div",{class:$(["form-group",{"has-error":!o.value}])},[e[8]||(e[8]=t("label",{for:"smtpServerPort"},"SMTP server port",-1)),y(t("input",{type:"number",id:"smtpServerPort",name:"smtpServerPort","onUpdate:modelValue":e[1]||(e[1]=l=>d.value=l),class:"form-control",required:""},null,512),[[T,d.value]])],2),e[15]||(e[15]=t("div",{class:"row"},null,-1)),t("div",dt,[e[9]||(e[9]=t("label",{for:"account"},"Authentication account",-1)),y(t("input",{type:"text",id:"account",name:"account","onUpdate:modelValue":e[2]||(e[2]=l=>i.value=l),class:"form-control"},null,512),[[T,i.value]])]),e[16]||(e[16]=t("div",{class:"row"},null,-1)),t("div",mt,[e[10]||(e[10]=t("label",{for:"password"},"Authentication password",-1)),y(t("input",{type:"password",id:"password",name:"password","onUpdate:modelValue":e[3]||(e[3]=l=>v.value=l),class:"form-control"},null,512),[[T,v.value]])]),e[17]||(e[17]=t("div",{class:"row"},null,-1)),t("div",vt,[y(t("input",{type:"checkbox",id:"enableTLS",name:"enableTLS","onUpdate:modelValue":e[4]||(e[4]=l=>b.value=l),class:"check-label"},null,512),[[K,b.value]]),e[11]||(e[11]=t("label",{for:"enableTLS"},"Use TLS",-1))]),e[18]||(e[18]=t("div",{class:"row"},null,-1)),t("div",{class:$(["form-group",{"has-error":!I.value}])},[e[12]||(e[12]=t("label",{for:"from"},"From address",-1)),y(t("input",{type:"email",id:"from",name:"from","onUpdate:modelValue":e[5]||(e[5]=l=>s.value=l),class:"form-control",required:""},null,512),[[T,s.value]])],2),e[19]||(e[19]=t("div",{class:"row"},null,-1)),t("div",{class:$(["form-group",{"has-error":!z.value}])},[e[13]||(e[13]=t("label",{for:"to"},[_("To address "),t("br"),_("(Separate multiple email address with a comma. E.g. testing@test.com,testing2@test.com)")],-1)),y(t("input",{type:"email",id:"to",name:"to","onUpdate:modelValue":e[6]||(e[6]=l=>a.value=l),class:"form-control",required:""},null,512),[[T,a.value]])],2)])]),t("div",ft,[t("button",{class:"btn btn-primary",type:"submit",disabled:!O.value},"Save",8,pt),t("button",{type:"button",class:"btn btn-default",onClick:Z},"Cancel")])],32)])])]))}}),bt=q(_t,[["__scopeId","data-v-405734be"]]),gt=Q("HealthChecksStore",()=>{const m=r({enabled:null,enable_tls:null,smtp_server:"",smtp_port:null,authentication_account:"",authentication_password:"",from:"",to:""}),u=X(),n=Y().serviceControlIsGreaterThan("5.2");async function c(){let s=null;try{const[,a]=await u.fetchTypedFromServiceControl("notifications/email");s=a}catch(a){console.error(a),s={enabled:!1,enable_tls:!1}}m.value={enabled:s.enabled,enable_tls:s.enable_tls,smtp_server:s.smtp_server?s.smtp_server:"",smtp_port:s.smtp_port?s.smtp_port:null,authentication_account:s.authentication_account?s.authentication_account:"",authentication_password:s.authentication_password?s.authentication_password:"",from:s.from?s.from:"",to:s.to?s.to:""}}async function d(){const s=await b(()=>u.postToServiceControl("notifications/email/toggle",{enabled:!(m.value.enabled??!0)}));return s.message==="success"?!0:(console.error(s.message),m.value.enabled=!m.value.enabled,!1)}async function i(){const s=await b(()=>u.postToServiceControl("notifications/email/test"),a=>n.value?a.headers.get("X-Particular-Reason")??a.statusText:a.statusText);return s.message==="success"?!0:(console.error(s.message),!1)}async function v(s){const a=await b(()=>u.postToServiceControl("notifications/email",s));return a.message==="success"?(m.value={enabled:m.value.enabled,enable_tls:s.enable_tls,smtp_server:s.smtp_server,smtp_port:s.smtp_port,authentication_account:s.authorization_account,authentication_password:s.authorization_password,from:s.from,to:s.to},!0):(console.error(a.message),!1)}async function b(s,a){const w=a??(o=>o.statusText);try{const o=await s();return{message:o.ok?"success":`error:${w(o)}`}}catch(o){return{message:o.message??o}}}return{refresh:c,emailNotifications:m,toggleEmailNotifications:d,saveEmailNotifications:v,testEmailNotifications:i}}),St={name:"notifications"},wt={class:"notifications row"},yt={class:"col-12"},ht={class:"row box box-no-click"},Ct={class:"col-12 no-side-padding"},Tt={class:"row"},kt={class:"col-auto"},Et={class:"connection-test connection-failed"},xt={class:"col-xs-9 col-sm-10 col-lg-11"},Nt={class:"row box-header"},Vt={class:"col-12"},$t={class:"endpoint-metadata"},Ut={class:"endpoint-metadata"},It={class:"connection-test connection-testing"},Pt={class:"connection-test connection-successful"},zt={class:"connection-test connection-failed"},At={class:"connection-test connection-successful"},Rt={class:"connection-test connection-failed"},Bt=M({__name:"HealthCheckNotifications",setup(m){const u=gt(),{emailNotifications:C}=j(u),n=r(null),c=r(null),d=r(null),i=r(null),v=r(!1);async function b(){n.value=null,i.value=null,d.value=await u.toggleEmailNotifications()}function s(){d.value=null,n.value=null,i.value=null,v.value=!0}async function a(w){i.value=null,v.value=!1,await u.saveEmailNotifications(w)?(i.value=!0,F(H.INFO,"Info","Email settings updated.")):(i.value=!1,F(H.ERROR,"Error","Failed to update the email settings."))}async function E(){c.value=!0,d.value=null,i.value=null,n.value=await u.testEmailNotifications(),c.value=!1}return J(async()=>{await u.refresh()}),(w,o)=>(p(),S("section",St,[f(at,null,{default:U(()=>[f(W,null,{default:U(()=>[t("section",null,[o[11]||(o[11]=t("div",{class:"row"},[t("div",{class:"col-12"},[t("p",{class:"screen-intro"},"Configure notifications for health checks built into ServiceControl (low disk space, stale database indexes, audit ingestion, etc.).")])],-1)),t("div",wt,[t("div",yt,[t("div",ht,[t("div",Ct,[t("div",Tt,[t("div",kt,[f(nt,{id:"emailNotifications",onToggle:b,value:g(C).enabled},null,8,["value"]),t("div",null,[t("span",Et,[d.value===!1?(p(),S(k,{key:0},[f(N,{icon:g(P)},null,8,["icon"]),o[1]||(o[1]=_(" Update failed ",-1))],64)):h("",!0)])])]),t("div",xt,[t("div",Nt,[t("div",Vt,[o[10]||(o[10]=t("p",{class:"lead"},"Email notifications",-1)),t("p",$t,[f(R,{variant:"link",size:"sm",icon:g(tt),onClick:s},{default:U(()=>[...o[2]||(o[2]=[_("Configure",-1)])]),_:1},8,["icon"])]),t("p",Ut,[f(R,{variant:"link",size:"sm",icon:g(et),onClick:E,disabled:!!c.value},{default:U(()=>[...o[3]||(o[3]=[_("Send test notification",-1)])]),_:1},8,["icon","disabled"]),t("span",It,[c.value?(p(),S(k,{key:0},[o[4]||(o[4]=t("i",{class:"glyphicon glyphicon-refresh rotate"},null,-1)),o[5]||(o[5]=_(" Testing ",-1))],64)):h("",!0)]),t("span",Pt,[n.value===!0?(p(),S(k,{key:0},[f(N,{icon:g(B)},null,8,["icon"]),o[6]||(o[6]=_(" Test email sent successfully ",-1))],64)):h("",!0)]),t("span",zt,[n.value===!1?(p(),S(k,{key:0},[f(N,{icon:g(P)},null,8,["icon"]),o[7]||(o[7]=_(" Test failed ",-1))],64)):h("",!0)]),t("span",At,[i.value===!0?(p(),S(k,{key:0},[f(N,{icon:g(B)},null,8,["icon"]),o[8]||(o[8]=_(" Update successful ",-1))],64)):h("",!0)]),t("span",Rt,[i.value===!1?(p(),S(k,{key:0},[f(N,{icon:g(P)},null,8,["icon"]),o[9]||(o[9]=_(" Update failed ",-1))],64)):h("",!0)])])])])])])])])])])])]),_:1}),(p(),A(st,{to:"#modalDisplay"},[v.value?(p(),A(bt,ot({key:0},g(C),{onCancel:o[0]||(o[0]=I=>v.value=!1),onSave:a}),null,16)):h("",!0)]))]),_:1})]))}}),Mt=q(Bt,[["__scopeId","data-v-6e4d26dc"]]);export{Mt as default};
//# sourceMappingURL=HealthCheckNotifications-BFpLKMld.js.map
