import{e as j,u as x,s as M,r as u,o as A,m as a,n as l,v,x as S,aq as B,q as o,y as d,a7 as O,t as g,bf as F,a8 as J,E as w,K as $,L as R,B as V,ax as q,U as L}from"./index-tFZp7u44.js";import{C}from"./CodeEditor-tk58yQKj.js";const U={name:"platformconnection"},D={class:"box configuration"},H={class:"row tabs-config-snippets"},Q={class:"col-12"},z={key:0,class:"tabs",role:"tablist"},G={key:1,class:"alert alert-warning",role:"alert"},I={key:2},K={class:"row"},W={class:"col-12 h-100"},X={key:3},Y={class:"row"},Z={class:"col-12 h-100"},ee=j({__name:"EndpointConnection",setup(oe){const f=x(),{serviceControlUrl:y,monitoringUrl:_}=M(f),s=u(!0),c=u(!0),p=u(""),m=u(""),h=u(""),r=u([]);async function b(){s.value=!0;const t=`var servicePlatformConnection = ServicePlatformConnectionConfiguration.Parse(@"<json>");

    endpointConfiguration.ConnectToServicePlatform(servicePlatformConnection);
    `;p.value=`var json = File.ReadAllText("<path-to-json-file>.json");
var servicePlatformConnection = ServicePlatformConnectionConfiguration.Parse(json);
endpointConfiguration.ConnectToServicePlatform(servicePlatformConnection);
`;const e=await P(),n={Heartbeats:e.serviceControl.settings.Heartbeats,CustomChecks:e.serviceControl.settings.CustomChecks,ErrorQueue:e.serviceControl.settings.ErrorQueue,SagaAudit:e.serviceControl.settings.SagaAudit,MessageAudit:e.serviceControl.settings.MessageAudit,Metrics:e.monitoring.settings};let i=JSON.stringify(n,null,4);h.value=i,i=i.replaceAll('"','""'),m.value=t.replace("<json>",i),r.value=[],r.value=r.value.concat(e.serviceControl.errors||[]),r.value=r.value.concat(e.monitoring.errors||[]),s.value=!1}A(async()=>{await b()});function k(){c.value=!0}function E(){c.value=!1}async function P(){const t=T(),e=N(),[n,i]=await Promise.all([t,e]);return{serviceControl:{settings:n?.settings??{},errors:n?.errors??[]},monitoring:{settings:i?.Metrics??{Enabled:!1},errors:i?.errors??[]}}}async function T(){try{const[,t]=await f.fetchTypedFromServiceControl("connection");return t}catch{return{errors:[`Error reaching ServiceControl at ${y.value} connection`]}}}async function N(){try{const[,t]=await f.fetchTypedFromMonitoring("connection");return{...t,errors:[]}}catch{return{Metrics:null,errors:[`Error SC Monitoring instance at ${_.value}connection`]}}}return(t,e)=>(l(),a("section",U,[v(q,null,{default:S(()=>[v(B,null,{default:S(()=>[o("div",D,[e[6]||(e[6]=o("div",{class:"row"},[o("div",{class:"col-12"},[o("h3",null,"Connect an endpoint to ServiceControl")])],-1)),e[7]||(e[7]=o("div",{class:"row"},[o("div",{class:"col-12"},[o("ol",null,[o("li",null,[d("Add the "),o("a",{href:"https://www.nuget.org/packages/NServiceBus.ServicePlatform.Connector/"},"NServiceBus.ServicePlatform.Connector"),d(" NuGet package to the endpoint project.")]),o("li",null,[d("Copy-paste the code from one of the options below. For additional options, refer to the "),o("a",{href:"https://docs.particular.net/platform/connecting"},"documentation")])])])],-1)),o("div",H,[o("div",Q,[O(v(F,null,null,512),[[J,s.value]]),s.value?g("",!0):(l(),a("div",z,[o("h5",{class:w({active:c.value})},[o("a",{onClick:e[0]||(e[0]=n=>k()),class:"ng-binding"},"Endpoint configuration only")],2),o("h5",{class:w({active:!c.value})},[o("a",{onClick:e[1]||(e[1]=n=>E()),class:"ng-binding"},"JSON file")],2)])),r.value.length>0&&!s.value?(l(),a("div",G,[e[2]||(e[2]=d(" There were problems reaching some ServiceControl instances and the configuration does not contain all connectivity information. ",-1)),o("ul",null,[(l(!0),a($,null,R(r.value,n=>(l(),a("li",{key:n},V(n),1))),128))])])):g("",!0),c.value&&!s.value?(l(),a("section",I,[o("div",K,[o("div",W,[v(C,{"model-value":m.value,language:"csharp","show-gutter":!1},null,8,["model-value"])])])])):g("",!0),!c.value&&!s.value?(l(),a("section",X,[o("div",Y,[o("div",Z,[e[3]||(e[3]=o("p",null,"Note that when using JSON for configuration, you also need to change the endpoint configuration as shown below.",-1)),e[4]||(e[4]=o("p",null,[o("strong",null,"Endpoint configuration:")],-1)),v(C,{"model-value":p.value,language:"csharp","show-gutter":!1},null,8,["model-value"]),e[5]||(e[5]=o("p",{style:{"margin-top":"15px"}},[o("strong",null,"JSON configuration file:")],-1)),v(C,{"model-value":h.value,language:"json","show-gutter":!1},null,8,["model-value"])])])])):g("",!0)])])])]),_:1})]),_:1})]))}}),se=L(ee,[["__scopeId","data-v-30bc303b"]]);export{se as default};
//# sourceMappingURL=EndpointConnection-DyxHhuiM.js.map
