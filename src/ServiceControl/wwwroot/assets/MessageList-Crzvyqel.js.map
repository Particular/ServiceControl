{"version":3,"file":"MessageList-Crzvyqel.js","sources":["../../../../frontend/src/components/failedmessages/MessageList.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { useRouter } from \"vue-router\";\nimport TimeSince from \"../TimeSince.vue\";\nimport NoData from \"../NoData.vue\";\nimport routeLinks from \"@/router/routeLinks\";\nimport { FailedMessageStatus, ExtendedFailedMessage } from \"@/resources/FailedMessage\";\nimport { hexToCSSFilter } from \"hex-to-css-filter\";\nimport FAIcon from \"@/components/FAIcon.vue\";\nimport { faRecycle, faRotateRight, faTrash, faLaptop } from \"@fortawesome/free-solid-svg-icons\";\nimport { faClock } from \"@fortawesome/free-regular-svg-icons\";\n\nexport interface IMessageList {\n  getSelectedMessages(): ExtendedFailedMessage[];\n  selectAll(): void;\n  deselectAll(): void;\n  resolveAll(): void;\n  isAnythingSelected(): ExtendedFailedMessage | undefined;\n  isAnythingDisplayed(): boolean;\n  numberDisplayed(): number;\n}\n\nlet lastLabelClickedIndex: number | undefined;\nconst router = useRouter();\nconst emit = defineEmits([\"retryRequested\"]);\nconst props = withDefaults(\n  defineProps<{\n    messages: ExtendedFailedMessage[];\n    showRequestRetry?: boolean;\n  }>(),\n  { showRequestRetry: false }\n);\n\nfunction getSelectedMessages() {\n  return props.messages.filter((m) => m.selected);\n}\n\nfunction selectAll() {\n  props.messages.forEach((m) => (m.selected = true));\n}\n\nfunction deselectAll() {\n  props.messages.forEach((m) => (m.selected = false));\n}\n\nfunction resolveAll() {\n  props.messages.forEach((m) => (m.resolved = true));\n}\n\nfunction isAnythingSelected() {\n  return props.messages.find((m) => m.selected);\n}\n\nfunction isAnythingDisplayed() {\n  return props.messages.length > 0;\n}\n\nfunction numberDisplayed() {\n  return props.messages.length;\n}\n\nfunction labelClicked($event: MouseEvent, index: number) {\n  //TODO: this functionality isn't consistent on including start/end items\n  if ($event.shiftKey && lastLabelClickedIndex != null) {\n    // toggle selection from lastLabel until current index\n    const start = (index < lastLabelClickedIndex ? index : lastLabelClickedIndex) + 1;\n    const end = (index < lastLabelClickedIndex ? lastLabelClickedIndex : index) + 1;\n\n    const messages = props.messages;\n    for (let x = start; x < end; x++) {\n      messages[x].selected = !messages[x].selected;\n    }\n\n    //clear selection\n    const selection = document.getSelection();\n    if (selection) {\n      selection.empty();\n    }\n  }\n\n  lastLabelClickedIndex = index;\n}\n\nfunction navigateToMessage(messageId: string) {\n  router.push({\n    path: routeLinks.messages.failedMessage.link(messageId),\n    query: { back: router.currentRoute.value.fullPath },\n  });\n}\n\ndefineExpose<IMessageList>({\n  getSelectedMessages,\n  selectAll,\n  deselectAll,\n  resolveAll,\n  isAnythingSelected,\n  isAnythingDisplayed,\n  numberDisplayed,\n});\nconst endpointColor = hexToCSSFilter(\"#929E9E\").filter;\n</script>\n\n<template>\n  <div class=\"row\">\n    <div class=\"col-sm-12\">\n      <no-data v-if=\"props.messages.length === 0\" title=\"message\" message=\"There are currently no messages\"></no-data>\n    </div>\n  </div>\n  <div v-for=\"(message, index) in props.messages\" class=\"row box repeat-item failed-message\" :key=\"message.id\">\n    <label class=\"check col-auto\" :for=\"`checkbox${message.id}`\" @click=\"labelClicked($event, index)\">\n      <input type=\"checkbox\" :disabled=\"message.retryInProgress || message.submittedForRetrial || message.deleteInProgress || message.restoreInProgress\" class=\"checkbox\" v-model=\"message.selected\" :value=\"message.id\" :id=\"`checkbox${message.id}`\" />\n    </label>\n    <div class=\"col-11 failed-message-data\">\n      <div class=\"row\">\n        <div class=\"col-12\">\n          <div class=\"row box-header\">\n            <div class=\"col-12 no-side-padding\" @click=\"navigateToMessage(message.id)\">\n              <p class=\"lead break\">{{ message.message_type || \"Message Type Unknown - missing metadata EnclosedMessageTypes\" }}</p>\n              <p class=\"metadata\">\n                <span v-if=\"message.submittedForRetrial\" :title=\"'Message was submitted for retrying'\" class=\"label sidebar-label label-info metadata-label\">To retry</span>\n                <span v-if=\"message.retryInProgress\" :title=\"'Message is being retried'\" class=\"label sidebar-label label-info metadata-label metadata in-progress\"><FAIcon :icon=\"faRotateRight\" /> Retry in progress</span>\n                <span v-if=\"message.retried\" :title=\"'Message is being retried'\" class=\"label sidebar-label label-info metadata-label metadata in-progress\"><FAIcon :icon=\"faRotateRight\" /> Retried</span>\n                <span v-if=\"message.resolved\" class=\"label sidebar-label label-info metadata-label\">Resolved</span>\n\n                <span v-if=\"message.deleteInProgress\" :title=\"'Message is being deleted'\" class=\"label sidebar-label label-info metadata-label metadata in-progress\"><FAIcon :icon=\"faTrash\" class=\"icon\" /> Scheduled for deletion</span>\n                <span v-if=\"message.archived\" :title=\"'Message is being deleted'\" class=\"label sidebar-label label-info metadata-label metadata in-progress\"><FAIcon :icon=\"faTrash\" class=\"icon\" /> Deleted</span>\n                <span v-if=\"message.number_of_processing_attempts > 1\" :title=\"`This message has already failed ${message.number_of_processing_attempts} times`\" class=\"label sidebar-label label-important metadata-label\"\n                  >{{ message.number_of_processing_attempts === 10 ? \"9+\" : message.number_of_processing_attempts - 1 }} Retry Failures</span\n                >\n                <span v-if=\"message.restoreInProgress\" v-tippy=\"`Message is being restored`\" class=\"label sidebar-label label-warning metadata-label metadata in-progress\"><FAIcon :icon=\"faRecycle\" class=\"icon\" /> Restore in progress</span>\n                <span v-if=\"message.edited\" :title=\"'Message was edited'\" class=\"label sidebar-label label-info metadata-label\">Edited</span>\n\n                <span class=\"metadata\"><FAIcon :icon=\"faClock\" class=\"icon\" /> Failed: <time-since :dateUtc=\"message.time_of_failure\"></time-since></span>\n                <span class=\"metadata\"><i class=\"fa pa-endpoint\" :style=\"{ filter: endpointColor }\"></i> Endpoint: {{ message.receiving_endpoint.name }}</span>\n                <span class=\"metadata\"><FAIcon :icon=\"faLaptop\" class=\"icon\" /> Machine: {{ message.receiving_endpoint.host }}</span>\n                <span class=\"metadata\" v-if=\"message.redirect\"><i class=\"fa pa-redirect-source pa-redirect-small\"></i> Redirect: {{ message.redirect }}</span>\n                <!-- for deleted messages-->\n                <span class=\"metadata\" v-if=\"message.status === FailedMessageStatus.Archived\"><FAIcon :icon=\"faClock\" class=\"icon\" /> Deleted: <time-since :date-utc=\"message.last_modified\"></time-since></span>\n                <span class=\"metadata danger\" v-if=\"message.status === FailedMessageStatus.Archived && message.delete_soon\"><FAIcon :icon=\"faTrash\" class=\"danger\" /> Scheduled for deletion: immediately</span>\n                <span class=\"metadata danger\" v-if=\"message.status === FailedMessageStatus.Archived && !message.delete_soon\">\n                  <FAIcon :icon=\"faTrash\" class=\"danger\" /> Scheduled for deletion: <time-since class=\"danger\" :date-utc=\"message.deleted_in\"></time-since>\n                </span>\n\n                <button type=\"button\" name=\"retryMessage\" v-if=\"!message.retryInProgress && props.showRequestRetry\" class=\"btn btn-link btn-sm\" @click.stop=\"emit('retryRequested', message.id)\">\n                  <FAIcon :icon=\"faRotateRight\" class=\"no-link-underline\" /> Request retry\n                </button>\n              </p>\n\n              <pre class=\"stacktrace-preview\">{{ message.exception.message }}</pre>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n@import \"../list.css\";\n\n.stacktrace-preview {\n  height: 38px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\npre {\n  display: block;\n  padding: 9.5px;\n  margin: 0 0 10px;\n  font-size: 13px;\n  line-height: 1.42857143;\n  color: #333333;\n  word-break: break-all;\n  word-wrap: break-word;\n  background-color: #f5f5f5;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n}\n\n.failed-message:hover {\n  border: 1px solid var(--sp-blue);\n  background-color: #edf6f7;\n}\n\n.repeat-item {\n  padding: 0 !important;\n}\n\n.check,\ndiv.failed-message-data {\n  padding-top: 15px;\n  padding-left: 25px;\n  padding-bottom: 0;\n}\n\n.pa-endpoint {\n  position: relative;\n  display: inline-block;\n  top: 3px;\n  background-image: url(\"@/assets/endpoint.svg\");\n  background-position: center;\n  background-repeat: no-repeat;\n  height: 15px;\n  width: 15px;\n}\n\n.checkbox {\n  margin-top: 1px;\n  margin-left: 1px;\n  width: 16px;\n  height: 16px;\n  border: 1px solid var(--reduced-emphasis);\n  background-color: #fff;\n}\n\n.checkbox:hover,\n.check-hover {\n  margin-top: 0;\n  margin-left: 0;\n  width: 18px;\n  height: 18px;\n  border: 2px solid var(--sp-blue);\n}\n\nlabel:after .checkbox {\n  opacity: 0;\n  content: \"\";\n  position: absolute;\n  width: 11px;\n  height: 7px;\n  background: transparent;\n  top: 2px;\n  left: 2px;\n  border: 3px solid #333;\n  border-top: none;\n  border-right: none;\n  transform: rotate(-45deg);\n}\n\n.checkbox input[type=\"checkbox\"]:checked + label:after {\n  opacity: 1;\n}\n\np.metadata {\n  margin-bottom: 6px;\n  position: relative;\n}\n\np.metadata button {\n  position: absolute;\n  right: 0px;\n  top: 0;\n}\n\n.failed-message .btn-link,\n.failed-message-group .btn-link,\n.deleted-message-group .btn-link {\n  color: var(--sp-blue);\n  font-size: 14px;\n  font-weight: bold;\n  padding: 0 36px 10px 0;\n  text-decoration: none;\n}\n\n.failed-message .metadata > .btn-link {\n  display: none;\n}\n\n.failed-message:hover .metadata > .btn-link {\n  display: block;\n}\n\n.failed-message .btn-link:hover,\n.failed-message-group .btn-link:hover,\n.deleted-message-group .btn-link:hover {\n  color: #23527c;\n  text-decoration: underline;\n}\n\n.label-info {\n  background-color: #1b809e;\n}\n\n.metadata-label {\n  margin-right: 24px;\n  position: relative;\n  top: -1px;\n}\n\n.sidebar-label,\n.sidebar-label.label-important {\n  box-shadow: none;\n  color: #ffffff;\n  display: inline-block;\n  font-size: 12px;\n  margin-top: 3px;\n  max-width: 100%;\n  padding: 6px 10px;\n}\n\n.label {\n  display: inline;\n  padding: 4px 0.6em 0.3em;\n  font-size: 13px;\n  font-weight: 700;\n  line-height: 1;\n  color: #fff;\n  text-align: center;\n  white-space: nowrap;\n  vertical-align: baseline;\n  border-radius: 0.25em;\n}\n\n.failed-message-data,\n.failed-message-group,\n.deleted-message-group {\n  cursor: pointer;\n}\n\n.failed-message-data:hover .lead.break,\n.failed-message-group:hover .lead.break,\n.deleted-message-group:hover .lead.break {\n  text-decoration: underline;\n}\n\n.pa-redirect-source {\n  background-image: url(\"@/assets/redirect-source.svg\");\n  background-position: center;\n  background-repeat: no-repeat;\n}\n\n.pa-redirect-small {\n  position: relative;\n  top: 1px;\n  height: 14px;\n  width: 14px;\n}\n\n.btn.btn-sm {\n  color: var(--sp-blue);\n  font-size: 14px;\n  font-weight: bold;\n  padding: 0 36px 10px 0;\n}\n\n.icon {\n  color: var(--reduced-emphasis);\n}\n</style>\n"],"names":["lastLabelClickedIndex","router","useRouter","emit","__emit","props","__props","getSelectedMessages","m","selectAll","deselectAll","resolveAll","isAnythingSelected","isAnythingDisplayed","numberDisplayed","labelClicked","$event","index","start","end","messages","x","selection","navigateToMessage","messageId","routeLinks","__expose","endpointColor","hexToCSSFilter","_createElementVNode","_hoisted_1","_hoisted_2","_createBlock","NoData","_openBlock","_createElementBlock","_Fragment","message","_vModelCheckbox","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_10","_toDisplayString","_hoisted_11","_hoisted_12","_hoisted_13","_createVNode","FAIcon","_unref","faRotateRight","_hoisted_14","_hoisted_15","_hoisted_16","faTrash","_hoisted_17","_hoisted_18","_withDirectives","_hoisted_19","faRecycle","_hoisted_20","_hoisted_21","faClock","TimeSince","_hoisted_22","_createTextVNode","_hoisted_23","faLaptop","_hoisted_24","FailedMessageStatus","_hoisted_25","_hoisted_26","_hoisted_27","_withModifiers","_hoisted_29"],"mappings":"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"}