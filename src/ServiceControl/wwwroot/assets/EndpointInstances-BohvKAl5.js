import{d as te,u as ne,r as h,a as ae,s as j,c as H,g as se,S as F,w as oe,h as le,b as ie,e as re,f as ce,i as U,j as de,k as ue,o as me,l as pe,m as T,n as u,p as I,q as t,t as M,C as be,T as fe,v as s,x as E,y as g,_ as p,z as a,A as ve,B as W,D as B,F as ge,E as P,G as _e,H as he,R as ye,I as x,J as L,N as Se,K as z,L as we,M as q,O as Y,P as b,Q as f,U as ke}from"./index-C-3C3fiy.js";import{_ as Ce,a as Ie}from"./LastHeartbeat.vue_vue_type_script_setup_true_lang-DscQ87Ez.js";import{O as Ee}from"./OnOffSwitch-CdRopK6h.js";var $=(o=>(o.InstanceName="name",o.LastHeartbeat="latestHeartbeat",o.MuteToggle="toggleMuteAlerts",o))($||{});const Re=new Map([["name",o=>o.host_display_name],["latestHeartbeat",o=>le.utc(o.heartbeat_information?.last_report_at??"1975-01-01T00:00:00")],["toggleMuteAlerts",o=>!o.monitor_heartbeat]]),Ae=te("HeartbeatInstancesStore",()=>{const o=ne(),v=h(""),_=ae(),{endpointInstances:y}=j(_),c=h({property:"name",isAscending:!0}),R=H(()=>y.value.sort(se(Re.get(c.value.property),c.value.isAscending?F.Ascending:F.Descending))),A=H(()=>R.value.filter(i=>!v.value||i.host_display_name.toLowerCase().includes(v.value.toLowerCase()))),S=()=>_.refresh();oe(v,i=>{m(i)});function m(i){v.value=i}async function D(i){await o.deleteFromServiceControl(`endpoints/${i.id}`),await _.refresh()}async function w(i){await Promise.all(i.map(k=>o.patchToServiceControl(`endpoints/${k.id}`,{monitor_heartbeat:!k.monitor_heartbeat}))),await _.refresh()}return{refresh:S,sortedInstances:R,filteredInstances:A,instanceFilterString:v,deleteEndpointInstance:D,toggleEndpointMonitor:w,sortByInstances:c}}),De=ie("heartbeatInstances",Ae,5e3),Ve={class:"container"},Te={class:"row"},xe={class:"col-8 instances-heading"},$e={style:{overflowWrap:"break-word"}},He={class:"col-4 align-content-center"},Me={class:"searchContainer"},Be={class:"row filters"},Le={class:"col-sm-12"},Ne={class:"buttonsContainer"},Oe=["disabled"],Fe=["disabled"],Ue={class:"row"},We={role:"table","aria-label":"endpoint-instances"},Pe={role:"row","aria-label":"column-headers",class:"row table-head-row",style:{borderTop:0}},ze={class:"d-flex align-items-center p-1"},qe={type:"button",class:"btn btn-danger btn-ms text-nowrap me-3"},Ye={class:"delete-all"},je={role:"rowgroup","aria-label":"endpoints"},Ge=["aria-label"],Je={role:"cell",class:"col-6 host-name"},Ke={role:"status",class:"status-icon"},Qe={class:"lead","aria-label":"instance-name"},Xe={role:"cell","aria-label":"last-heartbeat",class:"col-2 last-heartbeat"},Ze={role:"cell","aria-label":"mute toggle",class:"col-2 centre"},et={class:"switch"},tt={role:"cell","aria-label":"actions",class:"col-1 actions"},nt=["onClick"],at=re({__name:"EndpointInstances",setup(o){const v=ce(),_=U(),y=v.params.endpointName.toString(),{store:c}=De(),{filteredInstances:R,sortedInstances:A,instanceFilterString:S,sortByInstances:m}=j(c),D=de(),w=h([D.defaultEndpointSettingsValue]),i=h(ue.heartbeats.root),k=n=>n.filter(e=>e.name===y).filter(e=>!(!(w.value.find(l=>l.name===e.name)??w.value.find(l=>l.name==="")).track_instances&&!e.is_sending_heartbeats)),d=H(()=>k(R.value)),G=H(()=>k(A.value)),V=h(!1),C=h("mute");me(async()=>{const n=U().currentRoute.value.query.back;n&&(i.value=n),w.value=await D.getEndpointSettings()});function N(n){C.value=n,V.value=!0}function J(){V.value=!1}async function K(){V.value=!1;try{await c.toggleEndpointMonitor(d.value.filter(n=>C.value==="unmute"&&!n.monitor_heartbeat||C.value==="mute"&&n.monitor_heartbeat)),b(f.SUCCESS,`All endpoint instances ${C.value}`,"",!1,{timeout:1e3})}catch{b(f.ERROR,"Save failed","",!1,{timeout:3e3})}}async function Q(n){try{await c.deleteEndpointInstance(n),b(f.SUCCESS,"Endpoint instance deleted","",!1,{timeout:1e3})}catch{b(f.ERROR,"Delete failed","",!1,{timeout:3e3})}}async function X(){try{await Promise.all(A.value.filter(n=>n.name===y).map(n=>c.deleteEndpointInstance(n))),b(f.SUCCESS,"Endpoint deleted","",!1,{timeout:1e3}),await _.replace(i.value)}catch{b(f.ERROR,"Delete failed","",!1,{timeout:3e3})}}async function Z(n){try{await c.toggleEndpointMonitor([n]),b(f.SUCCESS,`Endpoint instance ${n.monitor_heartbeat?"unmuted":"muted"}`,"",!1,{timeout:1e3})}catch{b(f.ERROR,"Save failed","",!1,{timeout:3e3})}}return(n,e)=>{const O=pe("RouterLink");return u(),T(z,null,[(u(),I(fe,{to:"#modalDisplay"},[V.value?(u(),I(be,{key:0,heading:"Proceed with bulk operation",body:`Are you sure you want to ${C.value} ${d.value.length} endpoint instance(s)?`,onCancel:J,onConfirm:K},null,8,["body"])):M("",!0)])),t("div",Ve,[t("div",Te,[t("div",xe,[s(O,{to:i.value},{default:E(()=>[s(p,{icon:a(ve),size:"sm"},null,8,["icon"]),e[6]||(e[6]=g(" Back",-1))]),_:1},8,["to"]),t("h1",$e,W(a(y))+" Instances",1)]),t("div",He,[t("div",Me,[s(ge,{modelValue:a(S),"onUpdate:modelValue":e[0]||(e[0]=l=>B(S)?S.value=l:null)},null,8,["modelValue"])])])]),t("div",Be,[t("div",Le,[t("span",Ne,[t("button",{type:"button",class:"btn btn-warning btn-sm",disabled:d.value.length===0,onClick:e[1]||(e[1]=l=>N("mute"))},[s(p,{icon:a(_e),class:P(["icon",{"text-black":d.value.length>0}])},null,8,["icon","class"]),e[7]||(e[7]=g(" Mute Alerts on All ",-1))],8,Oe),t("button",{type:"button",class:"btn btn-default btn-sm",disabled:d.value.length===0,onClick:e[2]||(e[2]=l=>N("unmute"))},[s(p,{icon:a(he),class:P(["icon",{"text-black":d.value.length>0}])},null,8,["icon","class"]),e[8]||(e[8]=g(" Unmute Alerts on All ",-1))],8,Fe)])])]),t("div",Ue,[s(ye,{displayed:d.value.length,total:G.value.length},null,8,["displayed","total"])]),t("section",We,[t("div",Pe,[s(x,{name:a($).InstanceName,label:"Host Name",class:"col-6",modelValue:a(m),"onUpdate:modelValue":e[3]||(e[3]=l=>B(m)?m.value=l:null),sortable:"","default-ascending":""},null,8,["name","modelValue"]),s(x,{name:a($).LastHeartbeat,label:"Last Heartbeat",class:"col-2",modelValue:a(m),"onUpdate:modelValue":e[4]||(e[4]=l=>B(m)?m.value=l:null),sortable:""},null,8,["name","modelValue"]),s(x,{name:a($).MuteToggle,label:"Mute Alerts",class:"col-2 centre"},{help:E(()=>[...e[9]||(e[9]=[g("Mute an instance when you are planning to take the instance offline to do maintenance or some other reason. This will prevent alerts on the dashboard.",-1)])]),_:1},8,["name"]),s(x,{name:"actions",label:"Actions",class:"col-1"},{help:E(()=>[t("div",ze,[t("button",qe,[s(p,{icon:a(L),class:"icon text-white"},null,8,["icon"]),e[10]||(e[10]=g(" Delete",-1))]),e[11]||(e[11]=t("span",null,"Delete an instance when that instance has been decommissioned.",-1))])]),_:1})]),d.value.length===0?(u(),I(Se,{key:0,message:"No endpoint instances found. For untracked endpoints, disconnected instances are automatically pruned."},{default:E(()=>[t("div",Ye,[e[13]||(e[13]=t("span",null,"You may",-1)),t("button",{type:"button",onClick:e[5]||(e[5]=l=>X()),class:"btn btn-danger btn-sm"},[s(p,{icon:a(L),class:"icon text-white"},null,8,["icon"]),e[12]||(e[12]=g(" Delete",-1))]),e[14]||(e[14]=t("span",null,"this endpoint",-1))])]),_:1})):M("",!0),s(Ie,{data:d.value,"show-items-per-page":!0,"items-per-page":20},{data:E(({pageData:l})=>[t("div",je,[(u(!0),T(z,null,we(l,r=>(u(),T("div",{role:"row","aria-label":r.name,class:"row grid-row",key:r.id},[t("div",Je,[t("span",Ke,[r.heartbeat_information?.reported_status!==a(q).Alive?(u(),I(p,{key:0,"aria-label":"instance dead",icon:a(Y),class:"text-danger"},null,8,["icon"])):(u(),I(p,{key:1,"aria-label":"instance alive",icon:a(Y),class:"text-success"},null,8,["icon"]))]),t("span",Qe,W(r.host_display_name),1)]),t("div",Xe,[s(Ce,{date:r.heartbeat_information?.last_report_at,"tooltip-target":"instance"},null,8,["date"])]),t("div",Ze,[t("div",et,[s(Ee,{id:r.host_display_name,onToggle:ee=>Z(r),value:!r.monitor_heartbeat},null,8,["id","onToggle","value"])])]),t("div",tt,[r.heartbeat_information?.reported_status!==a(q).Alive?(u(),T("button",{key:0,type:"button",onClick:ee=>Q(r),class:"btn btn-danger btn-sm"},[s(p,{icon:a(L),class:"icon text-white"},null,8,["icon"]),e[15]||(e[15]=g(" Delete",-1))],8,nt)):M("",!0)])],8,Ge))),128))])]),_:1},8,["data"])])])],64)}}}),it=ke(at,[["__scopeId","data-v-fcde6857"]]);export{it as default};
//# sourceMappingURL=EndpointInstances-BohvKAl5.js.map
