{"version":3,"file":"FailedMessages-fFrUL4fI.js","sources":["../../../../frontend/src/components/failedmessages/FailedMessages.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, onUnmounted, ref, useTemplateRef, watch } from \"vue\";\nimport { useShowToast } from \"../../composables/toast\";\nimport { downloadFileFromString } from \"../../composables/fileDownloadCreator\";\nimport { onBeforeRouteLeave, useRoute } from \"vue-router\";\nimport createMessageGroupClient from \"./messageGroupClient\";\nimport LicenseNotExpired from \"../../components/LicenseNotExpired.vue\";\nimport OrderBy from \"@/components/OrderBy.vue\";\nimport ServiceControlAvailable from \"../ServiceControlAvailable.vue\";\nimport MessageList, { IMessageList } from \"./MessageList.vue\";\nimport ConfirmDialog from \"../ConfirmDialog.vue\";\nimport PaginationStrip from \"../../components/PaginationStrip.vue\";\nimport { ExtendedFailedMessage, FailedMessageStatus } from \"@/resources/FailedMessage\";\nimport SortOptions, { SortDirection } from \"@/resources/SortOptions\";\nimport { TYPE } from \"vue-toastification\";\nimport GroupOperation from \"@/resources/GroupOperation\";\nimport { faArrowDownAZ, faArrowDownZA, faArrowDownShortWide, faArrowDownWideShort, faArrowRotateRight, faTrash, faDownload } from \"@fortawesome/free-solid-svg-icons\";\nimport ActionButton from \"@/components/ActionButton.vue\";\nimport { useServiceControlStore } from \"@/stores/ServiceControlStore\";\nimport { useMessageStore } from \"@/stores/MessageStore\";\n\nconst serviceControlStore = useServiceControlStore();\nconst messageStore = useMessageStore();\nconst messageGroupClient = createMessageGroupClient();\n\nlet pollingFaster = false;\nlet refreshInterval: number | undefined;\nlet sortMethod: SortOptions<GroupOperation> | undefined;\nconst perPage = 50;\nconst route = useRoute();\nconst groupId = ref<string>(route.params.groupId as string);\nconst groupName = ref(\"\");\nconst pageNumber = ref(1);\nconst totalCount = ref(0);\nconst showDelete = ref(false);\nconst showConfirmRetryAll = ref(false);\nconst showConfirmDeleteAll = ref(false);\nconst messageList = useTemplateRef<IMessageList>(\"messageList\");\nconst messages = ref<ExtendedFailedMessage[]>([]);\nconst sortOptions: SortOptions<GroupOperation>[] = [\n  {\n    description: \"Time of failure\",\n    iconAsc: faArrowDownShortWide,\n    iconDesc: faArrowDownWideShort,\n  },\n  {\n    description: \"Message Type\",\n    iconAsc: faArrowDownAZ,\n    iconDesc: faArrowDownZA,\n  },\n];\n\nwatch(pageNumber, () => loadMessages());\n\nfunction sortGroups(sort: SortOptions<GroupOperation>) {\n  sortMethod = sort;\n  loadMessages();\n}\n\nfunction loadMessages() {\n  loadPagedMessages(groupId.value, pageNumber.value, sortMethod && sortMethod.description.replaceAll(\" \", \"_\").toLowerCase(), sortMethod?.dir);\n}\n\nasync function loadGroupDetails(groupId: string) {\n  const response = await serviceControlStore.fetchFromServiceControl(`recoverability/groups/id/${groupId}`);\n  const data = await response.json();\n  groupName.value = data.title;\n}\n\nfunction loadPagedMessages(groupId: string, page: number, sortBy?: string, direction?: SortDirection) {\n  sortBy ??= \"time_of_failure\";\n  direction ??= SortDirection.Descending;\n\n  let loadGroupDetailsPromise;\n  if (groupId && !groupName.value) {\n    loadGroupDetailsPromise = loadGroupDetails(groupId);\n  }\n\n  async function loadMessages() {\n    try {\n      const [response, data] = await serviceControlStore.fetchTypedFromServiceControl<ExtendedFailedMessage[]>(\n        `${groupId ? `recoverability/groups/${groupId}/` : \"\"}errors?status=${FailedMessageStatus.Unresolved}&page=${page}&per_page=${perPage}&sort=${sortBy}&direction=${direction}`\n      );\n      totalCount.value = parseInt(response.headers.get(\"Total-Count\") ?? \"\");\n      if (messages.value.length && data.length) {\n        // merge the previously selected messages into the new list so we can replace them\n        messages.value.forEach((previousMessage) => {\n          const receivedMessage = data.find((m) => m.id === previousMessage.id);\n          if (receivedMessage) {\n            if (previousMessage.last_modified === receivedMessage.last_modified) {\n              receivedMessage.retryInProgress = previousMessage.retryInProgress;\n              receivedMessage.deleteInProgress = previousMessage.deleteInProgress;\n            }\n\n            receivedMessage.selected = previousMessage.selected;\n          }\n        });\n      }\n      messages.value = data;\n    } catch (err) {\n      console.log(err);\n      const result = {\n        message: \"error\",\n      };\n      return result;\n    }\n  }\n\n  const loadMessagesPromise = loadMessages();\n\n  if (loadGroupDetailsPromise) {\n    return Promise.all([loadGroupDetailsPromise, loadMessagesPromise]);\n  }\n\n  return loadMessagesPromise;\n}\n\nasync function retryRequested(id: string) {\n  changeRefreshInterval(1000);\n  useShowToast(TYPE.INFO, \"Info\", \"Message retry requested...\");\n  await messageStore.retryMessages([id]);\n  const message = messages.value.find((m) => m.id === id);\n  if (message) {\n    message.retryInProgress = true;\n    message.selected = false;\n  }\n}\n\nasync function retrySelected() {\n  changeRefreshInterval(1000);\n  const selectedMessages = messageList.value?.getSelectedMessages() ?? [];\n  useShowToast(TYPE.INFO, \"Info\", \"Retrying \" + selectedMessages.length + \" messages...\");\n  await messageStore.retryMessages(selectedMessages.map((m) => m.id));\n  messageList.value?.deselectAll();\n  selectedMessages.forEach((m) => (m.retryInProgress = true));\n}\n\n//Not attempting to use explicit types correctly since this will need to change eventually anyway\nfunction exportSelected() {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  function toCSV(array: any[]) {\n    const delimiter = \",\";\n    const keys = Object.keys(array[0]);\n    let result = keys.join(delimiter) + \"\\n\";\n    array.forEach((obj) => {\n      result +=\n        keys\n          .map((k) => {\n            let v = String(obj[k]);\n            v = v.replaceAll('\"', '\"\"'); // Escape all double quotes\n            if (v.search(/([\",\\n])/g) >= 0) v = `\"${v}\"`; // Quote all values to deal with CR characters\n            return v;\n          })\n          .join(delimiter) + \"\\n\";\n    });\n\n    return result;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  function parseObject(obj: any | null, propertiesToSkip: string[], path = \"\") {\n    const type = typeof obj;\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    let d = {} as any;\n\n    if (obj != null && type === \"object\") {\n      for (const i in obj) {\n        const newD = parseObject(obj[i], propertiesToSkip, path + i + \".\");\n        d = Object.assign(d, newD);\n      }\n      return d;\n    } else if (type === \"number\" || type === \"string\" || type === \"boolean\" || obj == null) {\n      const endPath = path.substr(0, path.length - 1);\n      if (propertiesToSkip && propertiesToSkip.includes(endPath)) {\n        return d;\n      }\n      d[endPath] = obj;\n      return d;\n    }\n\n    return d;\n  }\n\n  const selectedMessages = messageList.value?.getSelectedMessages() ?? [];\n  const propertiesToSkip = [\"hover\", \"selected\", \"hover2\", \"$$hashKey\", \"panel\", \"edit_of\", \"edited\"];\n\n  const preparedMessagesForExport = [];\n  for (let i = 0; i < selectedMessages.length; i++) {\n    preparedMessagesForExport.push(parseObject(selectedMessages[i], propertiesToSkip));\n  }\n\n  const csvStr = toCSV(preparedMessagesForExport);\n  downloadFileFromString(csvStr, \"text/csv\", \"failedMessages.csv\");\n}\n\nfunction numberSelected() {\n  return messageList.value?.getSelectedMessages()?.length ?? 0;\n}\n\nfunction selectAll() {\n  messageList.value?.selectAll();\n}\n\nfunction deselectAll() {\n  messageList.value?.deselectAll();\n}\n\nfunction isAnythingSelected() {\n  return messageList?.value?.isAnythingSelected();\n}\n\nasync function deleteSelectedMessages() {\n  changeRefreshInterval(1000);\n  const selectedMessages = messageList.value?.getSelectedMessages() ?? [];\n\n  useShowToast(TYPE.INFO, \"Info\", \"Deleting \" + selectedMessages.length + \" messages...\");\n  await serviceControlStore.patchToServiceControl(\n    \"errors/archive\",\n    selectedMessages.map((m) => m.id)\n  );\n  messageList.value?.deselectAll();\n  selectedMessages.forEach((m) => (m.deleteInProgress = true));\n}\n\nasync function retryGroup() {\n  useShowToast(TYPE.INFO, \"Info\", \"Retrying all messages...\");\n  await messageGroupClient.retryExceptionGroup(groupId.value);\n  messages.value.forEach((m) => (m.retryInProgress = true));\n}\n\nasync function deleteGroup() {\n  useShowToast(TYPE.INFO, \"Info\", \"Deleting all messages...\");\n  await messageGroupClient.archiveExceptionGroup(groupId.value);\n  messages.value.forEach((m) => (m.deleteInProgress = true));\n}\n\nfunction isRetryOrDeleteOperationInProgress() {\n  return messages.value.some((message) => {\n    return message.retryInProgress || message.deleteInProgress;\n  });\n}\n\nfunction changeRefreshInterval(milliseconds: number) {\n  if (refreshInterval != null) {\n    window.clearInterval(refreshInterval);\n  }\n\n  refreshInterval = window.setInterval(() => {\n    // If we're currently polling at 5 seconds and there is a retry or delete in progress, then change the polling interval to poll every 1 second\n    if (!pollingFaster && isRetryOrDeleteOperationInProgress()) {\n      changeRefreshInterval(1000);\n      pollingFaster = true;\n    } else if (pollingFaster && !isRetryOrDeleteOperationInProgress()) {\n      // if we're currently polling every 1 second but all retries or deletes are done, change polling frequency back to every 5 seconds\n      changeRefreshInterval(5000);\n      pollingFaster = false;\n    }\n\n    loadMessages();\n  }, milliseconds);\n}\n\nonBeforeRouteLeave(() => {\n  groupId.value = \"\";\n  groupName.value = \"\";\n});\n\nonUnmounted(() => {\n  if (refreshInterval != null) {\n    window.clearInterval(refreshInterval);\n  }\n});\n\nonMounted(() => {\n  loadMessages();\n\n  changeRefreshInterval(5000);\n});\n</script>\n\n<template>\n  <ServiceControlAvailable>\n    <LicenseNotExpired>\n      <section name=\"message_groups\">\n        <div class=\"row\" v-if=\"groupName && messages.length > 0\">\n          <div class=\"col-sm-12\">\n            <h1 v-if=\"groupName\" class=\"active break group-title\">\n              {{ groupName }}\n            </h1>\n            <h3 class=\"active group-title group-message-count\">{{ totalCount }} messages in group</h3>\n          </div>\n        </div>\n        <div class=\"row\">\n          <div class=\"col-9\">\n            <div class=\"btn-toolbar\">\n              <ActionButton v-if=\"!isAnythingSelected()\" @click=\"selectAll\">Select all</ActionButton>\n              <ActionButton v-if=\"isAnythingSelected()\" @click=\"deselectAll\">Clear selection</ActionButton>\n              <ActionButton :icon=\"faArrowRotateRight\" @click=\"retrySelected()\" :disabled=\"!isAnythingSelected()\">Retry {{ numberSelected() }} selected</ActionButton>\n              <ActionButton :icon=\"faTrash\" @click=\"showDelete = true\" :disabled=\"!isAnythingSelected()\">Delete {{ numberSelected() }} selected</ActionButton>\n              <ActionButton :icon=\"faDownload\" @click=\"exportSelected()\" :disabled=\"!isAnythingSelected()\">Export {{ numberSelected() }} selected</ActionButton>\n              <ActionButton v-if=\"groupId\" :icon=\"faArrowRotateRight\" @click=\"showConfirmRetryAll = true\">Retry all</ActionButton>\n              <ActionButton v-if=\"groupId\" :icon=\"faTrash\" @click=\"showConfirmDeleteAll = true\">Delete all</ActionButton>\n            </div>\n          </div>\n          <div class=\"col-3\">\n            <OrderBy @sort-updated=\"sortGroups\" :sortOptions=\"sortOptions\" sortSavePrefix=\"all_failed_\"></OrderBy>\n          </div>\n        </div>\n        <div class=\"row\">\n          <div class=\"col-12\">\n            <MessageList :messages=\"messages\" :show-request-retry=\"true\" @retry-requested=\"retryRequested\" ref=\"messageList\"></MessageList>\n          </div>\n        </div>\n        <div class=\"row\">\n          <PaginationStrip v-model=\"pageNumber\" :total-count=\"totalCount\" :items-per-page=\"perPage\" />\n        </div>\n        <Teleport to=\"#modalDisplay\">\n          <ConfirmDialog\n            v-if=\"showDelete\"\n            @cancel=\"showDelete = false\"\n            @confirm=\"\n              showDelete = false;\n              deleteSelectedMessages();\n            \"\n            :heading=\"'Are you sure you want to delete the selected messages?'\"\n            :body=\"'If you delete, these messages won\\'t be available for retrying unless they\\'re later restored.'\"\n          ></ConfirmDialog>\n\n          <ConfirmDialog\n            v-if=\"showConfirmRetryAll\"\n            @cancel=\"showConfirmRetryAll = false\"\n            @confirm=\"\n              showConfirmRetryAll = false;\n              retryGroup();\n            \"\n            :heading=\"'Are you sure you want to retry the whole group?'\"\n            :body=\"'Retrying a whole group can take some time and put extra load on your system. Are you sure you want to retry all these messages?'\"\n          ></ConfirmDialog>\n\n          <ConfirmDialog\n            v-if=\"showConfirmDeleteAll\"\n            @cancel=\"showConfirmDeleteAll = false\"\n            @confirm=\"\n              showConfirmDeleteAll = false;\n              deleteGroup();\n            \"\n            :heading=\"'Are you sure you want to delete this group?'\"\n            :body=\"'If you delete, the messages in the group won\\'t be available for retrying unless they\\'re later restored.'\"\n          ></ConfirmDialog>\n        </Teleport>\n      </section>\n    </LicenseNotExpired>\n  </ServiceControlAvailable>\n</template>\n\n<style scoped></style>\n"],"names":["perPage","serviceControlStore","useServiceControlStore","messageStore","useMessageStore","messageGroupClient","createMessageGroupClient","pollingFaster","refreshInterval","sortMethod","route","useRoute","groupId","ref","groupName","pageNumber","totalCount","showDelete","showConfirmRetryAll","showConfirmDeleteAll","messageList","useTemplateRef","messages","sortOptions","faArrowDownShortWide","faArrowDownWideShort","faArrowDownAZ","faArrowDownZA","watch","loadMessages","sortGroups","sort","loadPagedMessages","loadGroupDetails","data","page","sortBy","direction","SortDirection","loadGroupDetailsPromise","response","FailedMessageStatus","previousMessage","receivedMessage","m","err","loadMessagesPromise","retryRequested","id","changeRefreshInterval","useShowToast","TYPE","message","retrySelected","selectedMessages","exportSelected","toCSV","array","keys","result","obj","k","v","parseObject","propertiesToSkip","path","type","d","i","newD","endPath","preparedMessagesForExport","csvStr","downloadFileFromString","numberSelected","selectAll","deselectAll","isAnythingSelected","deleteSelectedMessages","retryGroup","deleteGroup","isRetryOrDeleteOperationInProgress","milliseconds","onBeforeRouteLeave","onUnmounted","onMounted","_createBlock","ServiceControlAvailable","_createVNode","LicenseNotExpired","_createElementVNode","_hoisted_1","_openBlock","_createElementBlock","_hoisted_2","_hoisted_3","_hoisted_4","_toDisplayString","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","ActionButton","_cache","_unref","faArrowRotateRight","faTrash","faDownload","_hoisted_9","OrderBy","_hoisted_10","_hoisted_11","MessageList","_hoisted_12","PaginationStrip","$event","_Teleport","ConfirmDialog"],"mappings":"kzBA4BMA,EAAU,4CAPhB,MAAMC,EAAsBC,GAAA,EACtBC,EAAeC,GAAA,EACfC,EAAqBC,GAAA,EAE3B,IAAIC,EAAgB,GAChBC,EACAC,EAEJ,MAAMC,EAAQC,GAAA,EACRC,EAAUC,EAAYH,EAAM,OAAO,OAAiB,EACpDI,EAAYD,EAAI,EAAE,EAClBE,EAAaF,EAAI,CAAC,EAClBG,EAAaH,EAAI,CAAC,EAClBI,EAAaJ,EAAI,EAAK,EACtBK,EAAsBL,EAAI,EAAK,EAC/BM,EAAuBN,EAAI,EAAK,EAChCO,EAAcC,GAA6B,aAAa,EACxDC,EAAWT,EAA6B,EAAE,EAC1CU,EAA6C,CACjD,CACE,YAAa,kBACb,QAASC,GACT,SAAUC,EAAA,EAEZ,CACE,YAAa,eACb,QAASC,GACT,SAAUC,EAAA,CACZ,EAGFC,GAAMb,EAAY,IAAMc,GAAc,EAEtC,SAASC,EAAWC,EAAmC,CACrDtB,EAAasB,EACbF,EAAA,CACF,CAEA,SAASA,GAAe,CACtBG,GAAkBpB,EAAQ,MAAOG,EAAW,MAAON,GAAcA,EAAW,YAAY,WAAW,IAAK,GAAG,EAAE,YAAA,EAAeA,GAAY,GAAG,CAC7I,CAEA,eAAewB,GAAiBrB,EAAiB,CAE/C,MAAMsB,EAAO,MADI,MAAMjC,EAAoB,wBAAwB,4BAA4BW,CAAO,EAAE,GAC5E,KAAA,EAC5BE,EAAU,MAAQoB,EAAK,KACzB,CAEA,SAASF,GAAkBpB,EAAiBuB,EAAcC,EAAiBC,EAA2B,CACpGD,IAAW,kBACXC,IAAcC,GAAc,WAE5B,IAAIC,EACA3B,GAAW,CAACE,EAAU,QACxByB,EAA0BN,GAAiBrB,CAAO,GAGpD,eAAeiB,GAAe,CAC5B,GAAI,CACF,KAAM,CAACW,EAAUN,CAAI,EAAI,MAAMjC,EAAoB,6BACjD,GAAGW,EAAU,yBAAyBA,CAAO,IAAM,EAAE,iBAAiB6B,GAAoB,UAAU,SAASN,CAAI,aAAanC,CAAO,SAASoC,CAAM,cAAcC,CAAS,EAAA,EAE7KrB,EAAW,MAAQ,SAASwB,EAAS,QAAQ,IAAI,aAAa,GAAK,EAAE,EACjElB,EAAS,MAAM,QAAUY,EAAK,QAEhCZ,EAAS,MAAM,QAASoB,GAAoB,CAC1C,MAAMC,EAAkBT,EAAK,KAAMU,GAAMA,EAAE,KAAOF,EAAgB,EAAE,EAChEC,IACED,EAAgB,gBAAkBC,EAAgB,gBACpDA,EAAgB,gBAAkBD,EAAgB,gBAClDC,EAAgB,iBAAmBD,EAAgB,kBAGrDC,EAAgB,SAAWD,EAAgB,SAE/C,CAAC,EAEHpB,EAAS,MAAQY,CACnB,OAASW,EAAK,CACZ,eAAQ,IAAIA,CAAG,EACA,CACb,QAAS,OAAA,CAGb,CACF,CAEA,MAAMC,EAAsBjB,EAAAA,EAE5B,OAAIU,EACK,QAAQ,IAAI,CAACA,EAAyBO,CAAmB,CAAC,EAG5DA,CACT,CAEA,eAAeC,GAAeC,EAAY,CACxCC,EAAsB,GAAI,EAC1BC,EAAaC,EAAK,KAAM,OAAQ,4BAA4B,EAC5D,MAAMhD,EAAa,cAAc,CAAC6C,CAAE,CAAC,EACrC,MAAMI,EAAU9B,EAAS,MAAM,KAAMsB,GAAMA,EAAE,KAAOI,CAAE,EAClDI,IACFA,EAAQ,gBAAkB,GAC1BA,EAAQ,SAAW,GAEvB,CAEA,eAAeC,IAAgB,CAC7BJ,EAAsB,GAAI,EAC1B,MAAMK,EAAmBlC,EAAY,OAAO,oBAAA,GAAyB,CAAA,EACrE8B,EAAaC,EAAK,KAAM,OAAQ,YAAcG,EAAiB,OAAS,cAAc,EACtF,MAAMnD,EAAa,cAAcmD,EAAiB,IAAKV,GAAMA,EAAE,EAAE,CAAC,EAClExB,EAAY,OAAO,YAAA,EACnBkC,EAAiB,QAASV,GAAOA,EAAE,gBAAkB,EAAK,CAC5D,CAGA,SAASW,IAAiB,CAExB,SAASC,EAAMC,EAAc,CAE3B,MAAMC,EAAO,OAAO,KAAKD,EAAM,CAAC,CAAC,EACjC,IAAIE,EAASD,EAAK,KAAK,GAAS,EAAI;AAAA,EACpC,OAAAD,EAAM,QAASG,GAAQ,CACrBD,GACED,EACG,IAAKG,GAAM,CACV,IAAIC,EAAI,OAAOF,EAAIC,CAAC,CAAC,EACrB,OAAAC,EAAIA,EAAE,WAAW,IAAK,IAAI,EACtBA,EAAE,OAAO,WAAW,GAAK,IAAGA,EAAI,IAAIA,CAAC,KAClCA,CACT,CAAC,EACA,KAAK,GAAS,EAAI;AAAA,CACzB,CAAC,EAEMH,CACT,CAGA,SAASI,EAAYH,EAAiBI,EAA4BC,EAAO,GAAI,CAC3E,MAAMC,EAAO,OAAON,EAEpB,IAAIO,EAAI,CAAA,EAER,GAAIP,GAAO,MAAQM,IAAS,SAAU,CACpC,UAAWE,KAAKR,EAAK,CACnB,MAAMS,EAAON,EAAYH,EAAIQ,CAAC,EAAGJ,EAAkBC,EAAOG,EAAI,GAAG,EACjED,EAAI,OAAO,OAAOA,EAAGE,CAAI,CAC3B,CACA,OAAOF,CACT,SAAWD,IAAS,UAAYA,IAAS,UAAYA,IAAS,WAAaN,GAAO,KAAM,CACtF,MAAMU,EAAUL,EAAK,OAAO,EAAGA,EAAK,OAAS,CAAC,EAC9C,OAAID,GAAoBA,EAAiB,SAASM,CAAO,IAGzDH,EAAEG,CAAO,EAAIV,GACNO,CACT,CAEA,OAAOA,CACT,CAEA,MAAMb,EAAmBlC,EAAY,OAAO,oBAAA,GAAyB,CAAA,EAC/D4C,EAAmB,CAAC,QAAS,WAAY,SAAU,YAAa,QAAS,UAAW,QAAQ,EAE5FO,EAA4B,CAAA,EAClC,QAASH,EAAI,EAAGA,EAAId,EAAiB,OAAQc,IAC3CG,EAA0B,KAAKR,EAAYT,EAAiBc,CAAC,EAAGJ,CAAgB,CAAC,EAGnF,MAAMQ,EAAShB,EAAMe,CAAyB,EAC9CE,GAAuBD,EAAQ,WAAY,oBAAoB,CACjE,CAEA,SAASE,GAAiB,CACxB,OAAOtD,EAAY,OAAO,oBAAA,GAAuB,QAAU,CAC7D,CAEA,SAASuD,IAAY,CACnBvD,EAAY,OAAO,UAAA,CACrB,CAEA,SAASwD,IAAc,CACrBxD,EAAY,OAAO,YAAA,CACrB,CAEA,SAASyD,GAAqB,CAC5B,OAAOzD,GAAa,OAAO,mBAAA,CAC7B,CAEA,eAAe0D,IAAyB,CACtC7B,EAAsB,GAAI,EAC1B,MAAMK,EAAmBlC,EAAY,OAAO,oBAAA,GAAyB,CAAA,EAErE8B,EAAaC,EAAK,KAAM,OAAQ,YAAcG,EAAiB,OAAS,cAAc,EACtF,MAAMrD,EAAoB,sBACxB,iBACAqD,EAAiB,IAAKV,GAAMA,EAAE,EAAE,CAAA,EAElCxB,EAAY,OAAO,YAAA,EACnBkC,EAAiB,QAASV,GAAOA,EAAE,iBAAmB,EAAK,CAC7D,CAEA,eAAemC,IAAa,CAC1B7B,EAAaC,EAAK,KAAM,OAAQ,0BAA0B,EAC1D,MAAM9C,EAAmB,oBAAoBO,EAAQ,KAAK,EAC1DU,EAAS,MAAM,QAASsB,GAAOA,EAAE,gBAAkB,EAAK,CAC1D,CAEA,eAAeoC,IAAc,CAC3B9B,EAAaC,EAAK,KAAM,OAAQ,0BAA0B,EAC1D,MAAM9C,EAAmB,sBAAsBO,EAAQ,KAAK,EAC5DU,EAAS,MAAM,QAASsB,GAAOA,EAAE,iBAAmB,EAAK,CAC3D,CAEA,SAASqC,GAAqC,CAC5C,OAAO3D,EAAS,MAAM,KAAM8B,GACnBA,EAAQ,iBAAmBA,EAAQ,gBAC3C,CACH,CAEA,SAASH,EAAsBiC,EAAsB,CAC/C1E,GAAmB,MACrB,OAAO,cAAcA,CAAe,EAGtCA,EAAkB,OAAO,YAAY,IAAM,CAErC,CAACD,GAAiB0E,KACpBhC,EAAsB,GAAI,EAC1B1C,EAAgB,IACPA,GAAiB,CAAC0E,MAE3BhC,EAAsB,GAAI,EAC1B1C,EAAgB,IAGlBsB,EAAA,CACF,EAAGqD,CAAY,CACjB,CAEA,OAAAC,GAAmB,IAAM,CACvBvE,EAAQ,MAAQ,GAChBE,EAAU,MAAQ,EACpB,CAAC,EAEDsE,GAAY,IAAM,CACZ5E,GAAmB,MACrB,OAAO,cAAcA,CAAe,CAExC,CAAC,EAED6E,GAAU,IAAM,CACdxD,EAAA,EAEAoB,EAAsB,GAAI,CAC5B,CAAC,cAICqC,EAuE0BC,GAAA,KAAA,WAtExB,IAqEoB,CArEpBC,EAqEoBC,GAAA,KAAA,WApElB,IAmEU,CAnEVC,EAmEU,UAnEVC,GAmEU,CAlEe7E,EAAA,OAAaQ,EAAA,MAAS,OAAM,GAAnDsE,IAAAC,EAOM,MAPNC,GAOM,CANJJ,EAKM,MALNK,GAKM,CAJMjF,EAAA,WAAV+E,EAEK,KAFLG,GAEKC,EADAnF,EAAA,KAAS,EAAA,CAAA,YAEd4E,EAA0F,KAA1FQ,GAA0FD,EAApCjF,EAAA,KAAU,EAAG,qBAAkB,CAAA,CAAA,eAGzF0E,EAeM,MAfNS,GAeM,CAdJT,EAUM,MAVNU,GAUM,CATJV,EAQM,MARNW,GAQM,CAPiBxB,EAAA,gBAArBS,EAAuFgB,EAAA,OAA3C,QAAO3B,EAAA,aAAW,IAAU,CAAA,GAAA4B,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,GAAV,aAAU,EAAA,CAAA,YACpD1B,SAApBS,EAA6FgB,EAAA,OAAlD,QAAO1B,EAAA,aAAa,IAAe,CAAA,GAAA2B,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,GAAf,kBAAe,EAAA,CAAA,qBAC9Ef,EAAwJc,EAAA,CAAzI,KAAME,EAAAC,CAAA,EAAqB,uBAAOpD,MAAkB,UAAWwB,EAAA,CAAkB,aAAI,IAAM,GAAN,SAAMoB,EAAGvB,GAAc,EAAK,YAAS,CAAA,CAAA,+BACzIc,EAAgJc,EAAA,CAAjI,KAAME,EAAAE,CAAA,EAAU,uBAAOzF,EAAA,MAAU,IAAU,UAAW4D,EAAA,CAAkB,aAAI,IAAO,GAAP,UAAOoB,EAAGvB,GAAc,EAAK,YAAS,CAAA,CAAA,+BACjIc,EAAkJc,EAAA,CAAnI,KAAME,EAAAG,EAAA,EAAa,uBAAOpD,MAAmB,UAAWsB,EAAA,CAAkB,aAAI,IAAO,GAAP,UAAOoB,EAAGvB,GAAc,EAAK,YAAS,CAAA,CAAA,+BAC/G9D,EAAA,WAApB0E,EAAoHgB,EAAA,OAAtF,KAAME,EAAAC,CAAA,EAAqB,uBAAOvF,EAAA,MAAmB,GAAA,aAAS,IAAS,CAAA,GAAAqF,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,GAAT,YAAS,EAAA,CAAA,gCACjF3F,EAAA,WAApB0E,EAA2GgB,EAAA,OAA7E,KAAME,EAAAE,CAAA,EAAU,uBAAOvF,EAAA,MAAoB,GAAA,aAAS,IAAU,CAAA,GAAAoF,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAA,GAAV,aAAU,EAAA,CAAA,oCAGhGb,EAEM,MAFNkB,GAEM,CADJpB,EAAsGqB,GAAA,CAA5F,cAAc/E,EAAa,YAAAP,EAA0B,eAAe,aAAA,OAGlFmE,EAIM,MAJNoB,GAIM,CAHJpB,EAEM,MAFNqB,GAEM,CADJvB,EAA+HwB,GAAA,CAAjH,SAAU1F,EAAA,MAAW,qBAAoB,GAAO,iBAAiByB,WAAoB,cAAJ,IAAI3B,CAAA,2BAGvGsE,EAEM,MAFNuB,GAEM,CADJzB,EAA4F0B,GAAA,YAAlEnG,EAAA,2CAAAA,EAAU,MAAAoG,GAAG,cAAanG,EAAA,MAAa,iBAAgBhB,CAAA,8CAEnFsF,EAiCW8B,GAAA,CAjCD,GAAG,iBAAe,CAElBnG,EAAA,WADRqE,EASiB+B,EAAA,OAPd,wBAAQpG,EAAA,MAAU,IAClB,UAAOsF,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAY,GAAA,CAAiBlG,EAAA,MAAU,GAAwB6D,GAAA,IAI1D,QAAS,yDACT,KAAM,8FAAA,aAID5D,EAAA,WADRoE,EASiB+B,EAAA,OAPd,wBAAQnG,EAAA,MAAmB,IAC3B,UAAOqF,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAY,GAAA,CAAiBjG,EAAA,MAAmB,GAAwB6D,GAAA,IAInE,QAAS,kDACT,KAAM,iIAAA,aAID5D,EAAA,WADRmE,EASiB+B,EAAA,OAPd,0BAAQlG,EAAA,MAAoB,IAC5B,UAAOoF,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAY,GAAA,CAAiBhG,EAAA,MAAoB,GAAwB6D,GAAA,IAIpE,QAAS,8CACT,KAAM,yGAAA"}